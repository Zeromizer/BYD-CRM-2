var se=Object.defineProperty;var te=(s,t,a)=>t in s?se(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var S=(s,t,a)=>te(s,typeof t!="symbol"?t+"":t,a);import{c as ae,u as V,a as O,b as T,j as e,Q as ne,d as ie}from"./vendor-state-HHgQU-Dp.js";import{a as W,r as _,B as re,b as le,d as Y,R as oe}from"./vendor-react-D_6SLu_M.js";import{D as ce}from"./vendor-db-Z29b7Thg.js";import{o as H,b as z,s as g,r as $,l as D,n as G}from"./vendor-utils-BN0HniSu.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function a(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=a(n);fetch(n.href,r)}})();var M={},U=W;M.createRoot=U.createRoot,M.hydrateRoot=U.hydrateRoot;const k={GOOGLE:{CLIENT_ID:"876961148543-8sdj3cti6q9tc523natb3g6jt789qlbr.apps.googleusercontent.com",API_KEY:"AIzaSyDH6E6B4u1m_uvr0mSdCxaCYIkzjSqUuY8",SCOPES:["https://www.googleapis.com/auth/drive","https://www.googleapis.com/auth/drive.appdata"].join(" "),DISCOVERY_DOCS:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]},DRIVE_FOLDERS:{ROOT:"BYD CRM",CUSTOMERS_DATA:"BYD Customers Data",FORMS:"BYD CRM - Form Templates",EXCEL:"BYD CRM - Excel Templates",CUSTOMER_SUBFOLDERS:["NRIC","Test Drive","VSA","Trade In","Other Documents"]},SYNC:{BATCH_SIZE:10,RETRY_LIMIT:3,RETRY_DELAY:1e3,AUTO_SYNC_INTERVAL:5*60*1e3,TIMEOUT:3e4},ENCRYPTION:{SALT:"r0h/xM9JXK/AAblYO0mdtS27/nFWwu4xKB8rp/+z83k=",ALGORITHM:"AES"},UI:{ITEMS_PER_PAGE:20,DEBOUNCE_DELAY:300,TOAST_DURATION:3e3,MAX_FILE_SIZE:10*1024*1024},APP:{NAME:"BYD CRM",VERSION:"2.0.0",ENV:"development"},FEATURES:{OFFLINE_MODE:!0,AUTO_SYNC:!0,DATA_ENCRYPTION:!0,DEBUG_MODE:!1}};function de(){const s=[];return{valid:s.length===0,errors:s}}const A=class A{constructor(){S(this,"auth",null);S(this,"isInitialized",!1)}static getInstance(){return A.instance||(A.instance=new A),A.instance}async init(){if(!this.isInitialized)return new Promise((t,a)=>{if(window.gapi){this.loadAuth(t,a);return}const i=document.createElement("script");i.src="https://apis.google.com/js/api.js",i.async=!0,i.defer=!0,i.onload=()=>{this.loadAuth(t,a)},i.onerror=()=>{a(new Error("Failed to load Google API script"))},document.body.appendChild(i)})}loadAuth(t,a){gapi.load("client:auth2",async()=>{try{await gapi.client.init({apiKey:k.GOOGLE.API_KEY,clientId:k.GOOGLE.CLIENT_ID,discoveryDocs:[...k.GOOGLE.DISCOVERY_DOCS],scope:k.GOOGLE.SCOPES}),this.auth=gapi.auth2.getAuthInstance(),this.isInitialized=!0,console.log("âœ… Google API initialized"),t()}catch(i){console.error("âŒ Failed to initialize Google API:",i),a(i instanceof Error?i:new Error("Failed to initialize Google API"))}})}async signIn(){if(!this.auth)throw new Error("Google Auth not initialized. Call init() first.");try{const a=(await this.auth.signIn()).getBasicProfile(),i={id:a.getId(),email:a.getEmail(),name:a.getName(),picture:a.getImageUrl()};return sessionStorage.setItem("consultant",JSON.stringify(i)),console.log("âœ… Signed in as:",i.email),i}catch(t){throw console.error("âŒ Sign in failed:",t),new Error("Failed to sign in with Google")}}async signOut(){if(!this.auth)throw new Error("Google Auth not initialized");try{await this.auth.signOut(),sessionStorage.removeItem("consultant"),console.log("âœ… Signed out")}catch(t){throw console.error("âŒ Sign out failed:",t),new Error("Failed to sign out")}}isSignedIn(){var t;return((t=this.auth)==null?void 0:t.isSignedIn.get())??!1}getCurrentConsultant(){const t=sessionStorage.getItem("consultant");if(!t)return null;try{return JSON.parse(t)}catch{return null}}getAccessToken(){var a;const t=(a=this.auth)==null?void 0:a.currentUser.get();return(t==null?void 0:t.getAuthResponse().access_token)??""}onAuthStateChange(t){if(!this.auth)return console.warn("Auth not initialized, cannot listen to state changes"),()=>{};const a=this.auth.isSignedIn.listen(t);return()=>{console.log("Cleaned up auth listener:",a)}}getIsInitialized(){return this.isInitialized}};S(A,"instance");let P=A;const C=P.getInstance();class ue extends ce{constructor(){super("BYD_CRM_DB");S(this,"customers");S(this,"formTemplates");S(this,"excelTemplates");S(this,"syncQueue");this.version(1).stores({customers:"id, consultantId, name, createdAt, updatedAt, dealClosed",formTemplates:"id, consultantId, name, createdAt",excelTemplates:"id, consultantId, name, createdAt",syncQueue:"id, consultantId, status, entityType, createdAt"})}async clearConsultantData(a){await this.transaction("rw",[this.customers,this.formTemplates,this.excelTemplates,this.syncQueue],async()=>{await this.customers.where("consultantId").equals(a).delete(),await this.formTemplates.where("consultantId").equals(a).delete(),await this.excelTemplates.where("consultantId").equals(a).delete(),await this.syncQueue.where("consultantId").equals(a).delete()})}async getStats(a){return{customers:await this.customers.where("consultantId").equals(a).count(),forms:await this.formTemplates.where("consultantId").equals(a).count(),excel:await this.excelTemplates.where("consultantId").equals(a).count(),pendingSync:await this.syncQueue.where({consultantId:a,status:"pending"}).count()}}}const E=new ue,me=ae((s,t)=>({consultant:null,isInitialized:!1,isSignedIn:!1,isLoading:!1,error:null,init:async()=>{try{s({isLoading:!0,error:null}),await C.init();const a=C.isSignedIn(),i=a?C.getCurrentConsultant():null;s({isInitialized:!0,isSignedIn:a,consultant:i,isLoading:!1}),console.log("âœ… Auth initialized, signed in:",a)}catch(a){const i=a instanceof Error?a.message:"Failed to initialize auth";s({isInitialized:!0,isLoading:!1,error:i}),console.error("âŒ Auth initialization failed:",i)}},signIn:async()=>{try{s({isLoading:!0,error:null});const a=await C.signIn();s({consultant:a,isSignedIn:!0,isLoading:!1}),console.log("âœ… Signed in successfully")}catch(a){const i=a instanceof Error?a.message:"Failed to sign in";throw s({isLoading:!1,error:i}),console.error("âŒ Sign in failed:",i),a}},signOut:async()=>{try{s({isLoading:!0,error:null});const a=t().consultant;await C.signOut(),a&&(await E.clearConsultantData(a.id),console.log("âœ… Cleared local data for consultant:",a.id)),s({consultant:null,isSignedIn:!1,isLoading:!1}),console.log("âœ… Signed out successfully")}catch(a){const i=a instanceof Error?a.message:"Failed to sign out";throw s({isLoading:!1,error:i}),console.error("âŒ Sign out failed:",i),a}},clearError:()=>s({error:null})}));function he(){const s=me();return _.useEffect(()=>{s.isInitialized||s.init()},[s.isInitialized,s.init]),{consultant:s.consultant,isSignedIn:s.isSignedIn,isInitialized:s.isInitialized,isLoading:s.isLoading,error:s.error,signIn:s.signIn,signOut:s.signOut,clearError:s.clearError,isReady:s.isInitialized&&!s.isLoading}}const R=H({id:g().uuid(),consultantId:g().min(1,"Consultant ID required"),name:g().min(2,"Name must be at least 2 characters").max(100,"Name must be less than 100 characters").trim(),phone:g().regex(/^\+?[0-9\s-()]+$/,"Invalid phone number format").min(8,"Phone number too short").max(20,"Phone number too long").trim(),email:g().email("Invalid email address").optional().or(D("")).transform(s=>s===""?void 0:s),nric:g().regex(/^[STFG]\d{7}[A-Z]$/,"Invalid NRIC format (e.g., S1234567A)").toUpperCase().trim(),dob:g().regex(/^\d{4}-\d{2}-\d{2}$/,"Date must be in YYYY-MM-DD format"),occupation:g().max(100,"Occupation too long").optional().or(D("")).transform(s=>s===""?void 0:s),address:g().min(5,"Address must be at least 5 characters").max(200,"Address too long").trim(),addressContinue:g().max(200,"Address continuation too long").optional().or(D("")).transform(s=>s===""?void 0:s),salesConsultant:g().min(2,"Sales consultant name required").trim(),vsaNo:g().optional().or(D("")).transform(s=>s===""?void 0:s),dealClosed:z().default(!1),driveFolderId:g().optional(),driveFolderLink:g().url().optional().or(D("")).transform(s=>s===""?void 0:s),subfolders:$(g()).optional(),notes:g().max(2e3,"Notes too long").optional().or(D("")).transform(s=>s===""?void 0:s),checklist:$(z()).default({}),createdAt:g().datetime(),updatedAt:g().datetime(),encrypted:z().default(!1)});R.omit({id:!0,consultantId:!0,createdAt:!0,updatedAt:!0,encrypted:!0,driveFolderId:!0,driveFolderLink:!0,subfolders:!0});R.omit({id:!0,consultantId:!0,createdAt:!0,updatedAt:!0,encrypted:!0}).partial();H({query:g().min(1,"Search query required"),limit:G().min(1).max(100).default(20),offset:G().min(0).default(0)});class pe{async getAll(){const t=C.getCurrentConsultant();if(!t)throw new Error("Not authenticated");return E.customers.where("consultantId").equals(t.id).reverse().sortBy("createdAt")}async getById(t){const a=C.getCurrentConsultant();if(!a)throw new Error("Not authenticated");const i=await E.customers.get(t);if(i&&i.consultantId!==a.id)throw new Error("Unauthorized: Cannot access another consultant's customer");return i||null}async create(t){const a=C.getCurrentConsultant();if(!a)throw new Error("Not authenticated");const i=crypto.randomUUID(),n={...t,id:i,consultantId:a.id,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),encrypted:!1,checklist:t.checklist||{},dealClosed:t.dealClosed||!1},r=R.parse(n);return await E.customers.add(r),console.log("âœ… Customer created:",r.id),r}async update(t,a){const i=C.getCurrentConsultant();if(!i)throw new Error("Not authenticated");const n=await this.getById(t);if(!n)throw new Error("Customer not found");const r={...n,...a,id:t,consultantId:i.id,updatedAt:new Date().toISOString()},l=R.parse(r);return await E.customers.put(l),console.log("âœ… Customer updated:",l.id),l}async delete(t){if(!C.getCurrentConsultant())throw new Error("Not authenticated");if(!await this.getById(t))throw new Error("Customer not found");await E.customers.delete(t),console.log("âœ… Customer deleted:",t)}async search(t){if(!C.getCurrentConsultant())throw new Error("Not authenticated");const i=await this.getAll(),n=t.toLowerCase().trim();return n?i.filter(r=>{var l,m;return r.name.toLowerCase().includes(n)||r.phone.includes(t)||((l=r.email)==null?void 0:l.toLowerCase().includes(n))||r.nric.toLowerCase().includes(n)||((m=r.vsaNo)==null?void 0:m.toLowerCase().includes(n))}):i}async getByDealStatus(t){const a=C.getCurrentConsultant();if(!a)throw new Error("Not authenticated");return E.customers.where({consultantId:a.id,dealClosed:t}).reverse().sortBy("updatedAt")}async toggleDealClosed(t){const a=await this.getById(t);if(!a)throw new Error("Customer not found");return this.update(t,{dealClosed:!a.dealClosed})}async updateChecklistItem(t,a,i){const n=await this.getById(t);if(!n)throw new Error("Customer not found");const r={...n.checklist,[a]:i};return this.update(t,{checklist:r})}async getStats(){if(!C.getCurrentConsultant())throw new Error("Not authenticated");const a=await this.getAll();return{total:a.length,open:a.filter(i=>!i.dealClosed).length,closed:a.filter(i=>i.dealClosed).length}}}const L=new pe,y={customers:["customers"],customer:s=>["customers",s],stats:["customers","stats"],search:s=>["customers","search",s]},xe=()=>V({queryKey:y.customers,queryFn:()=>L.getAll()}),ge=s=>V({queryKey:y.customer(s),queryFn:()=>L.getById(s),enabled:!!s}),fe=()=>{const s=O();return T({mutationFn:t=>L.create(t),onSuccess:()=>{s.invalidateQueries({queryKey:y.customers}),s.invalidateQueries({queryKey:y.stats})}})},_e=()=>{const s=O();return T({mutationFn:({customerId:t,data:a})=>L.update(t,a),onSuccess:(t,a)=>{s.invalidateQueries({queryKey:y.customers}),s.invalidateQueries({queryKey:y.customer(a.customerId)}),s.invalidateQueries({queryKey:y.stats})}})},je=()=>{const s=O();return T({mutationFn:t=>L.delete(t),onSuccess:()=>{s.invalidateQueries({queryKey:y.customers}),s.invalidateQueries({queryKey:y.stats})}})},ve=()=>{const s=O();return T({mutationFn:({customerId:t,key:a,value:i})=>L.updateChecklistItem(t,a,i),onSuccess:(t,a)=>{s.invalidateQueries({queryKey:y.customers}),s.invalidateQueries({queryKey:y.customer(a.customerId)})}})},v=({variant:s="primary",size:t="medium",loading:a=!1,fullWidth:i=!1,disabled:n,children:r,className:l="",...m})=>{const c=["btn",`btn--${s}`,`btn--${t}`,i&&"btn--full-width",a&&"btn--loading",l].filter(Boolean).join(" ");return e.jsxs("button",{className:c,disabled:n||a,...m,children:[a&&e.jsx("span",{className:"btn__spinner","aria-hidden":"true",children:e.jsx("svg",{className:"btn__spinner-svg",viewBox:"0 0 24 24",children:e.jsx("circle",{className:"btn__spinner-circle",cx:"12",cy:"12",r:"10",fill:"none",strokeWidth:"3"})})}),e.jsx("span",{className:a?"btn__text--hidden":"btn__text",children:r})]})},b=_.forwardRef(({label:s,error:t,helperText:a,fullWidth:i=!1,leftIcon:n,rightIcon:r,className:l="",id:m,required:c,disabled:o,...u},h)=>{const d=m||`input-${Math.random().toString(36).substr(2,9)}`,N=!!t,x=["input-wrapper",i&&"input-wrapper--full-width",o&&"input-wrapper--disabled"].filter(Boolean).join(" "),f=["input",N&&"input--error",n&&"input--has-left-icon",r&&"input--has-right-icon",l].filter(Boolean).join(" ");return e.jsxs("div",{className:x,children:[s&&e.jsxs("label",{htmlFor:d,className:"input-label",children:[s,c&&e.jsx("span",{className:"input-label__required",children:"*"})]}),e.jsxs("div",{className:"input-container",children:[n&&e.jsx("span",{className:"input-icon input-icon--left",children:n}),e.jsx("input",{ref:h,id:d,className:f,disabled:o,"aria-invalid":N,"aria-describedby":t?`${d}-error`:a?`${d}-helper`:void 0,...u}),r&&e.jsx("span",{className:"input-icon input-icon--right",children:r})]}),t&&e.jsx("p",{id:`${d}-error`,className:"input-message input-message--error",children:t}),!t&&a&&e.jsx("p",{id:`${d}-helper`,className:"input-message input-message--helper",children:a})]})});b.displayName="Input";const J=_.forwardRef(({label:s,error:t,helperText:a,fullWidth:i=!1,className:n="",id:r,required:l,disabled:m,...c},o)=>{const u=r||`textarea-${Math.random().toString(36).substr(2,9)}`,h=!!t,d=["input-wrapper",i&&"input-wrapper--full-width",m&&"input-wrapper--disabled"].filter(Boolean).join(" "),N=["input",h&&"input--error",n].filter(Boolean).join(" ");return e.jsxs("div",{className:d,children:[s&&e.jsxs("label",{htmlFor:u,className:"input-label",children:[s,l&&e.jsx("span",{className:"input-label__required",children:"*"})]}),e.jsx("textarea",{ref:o,id:u,className:N,disabled:m,"aria-invalid":h,"aria-describedby":t?`${u}-error`:a?`${u}-helper`:void 0,...c}),t&&e.jsx("p",{id:`${u}-error`,className:"input-message input-message--error",children:t}),!t&&a&&e.jsx("p",{id:`${u}-helper`,className:"input-message input-message--helper",children:a})]})});J.displayName="Textarea";const Ce=({isOpen:s,onClose:t,title:a,children:i,size:n="medium",showCloseButton:r=!0,closeOnOverlayClick:l=!0,closeOnEscape:m=!0})=>{const c=_.useRef(null);if(_.useEffect(()=>{const h=d=>{m&&d.key==="Escape"&&s&&t()};return s&&(document.addEventListener("keydown",h),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",h),document.body.style.overflow=""}},[s,t,m]),_.useEffect(()=>{if(s&&c.current){const d=c.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')[0];d==null||d.focus()}},[s]),!s)return null;const o=h=>{l&&h.target===h.currentTarget&&t()},u=e.jsx("div",{className:"modal-overlay",onClick:o,role:"dialog","aria-modal":"true",children:e.jsxs("div",{ref:c,className:`modal modal--${n}`,children:[(a||r)&&e.jsxs("div",{className:"modal__header",children:[a&&e.jsx("h2",{className:"modal__title",children:a}),r&&e.jsx("button",{type:"button",className:"modal__close",onClick:t,"aria-label":"Close modal",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsx("div",{className:"modal__content",children:i})]})});return W.createPortal(u,document.body)},X=({size:s="medium",color:t="primary",fullScreen:a=!1,label:i="Loading..."})=>{const n=e.jsxs("div",{className:`spinner spinner--${s} spinner--${t}`,role:"status",children:[e.jsx("svg",{className:"spinner__svg",viewBox:"0 0 50 50",children:e.jsx("circle",{className:"spinner__circle",cx:"25",cy:"25",r:"20",fill:"none",strokeWidth:"4"})}),e.jsx("span",{className:"spinner__label",children:i})]});return a?e.jsx("div",{className:"spinner-container spinner-container--fullscreen",children:n}):n},Ne=s=>s.split(" ").map(t=>t[0]).join("").substring(0,2).toUpperCase(),be=s=>{const t=["#00BCD4","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F3","#00BCD4","#009688"],a=s.charCodeAt(0)%t.length;return t[a]},ye=({onSelectCustomer:s,onCreateCustomer:t,selectedCustomerId:a})=>{const[i,n]=_.useState(""),{data:r=[],isLoading:l,error:m}=xe(),c=_.useMemo(()=>{let o=[...r];if(i.trim()){const u=i.toLowerCase();o=o.filter(h=>{var d;return h.name.toLowerCase().includes(u)||h.phone.includes(u)||((d=h.email)==null?void 0:d.toLowerCase().includes(u))||h.nric.toLowerCase().includes(u)})}return o.sort((u,h)=>new Date(h.createdAt).getTime()-new Date(u.createdAt).getTime()),o},[r,i]);return l?e.jsx("div",{className:"customer-list",children:e.jsx("div",{className:"customer-list__loading",children:e.jsx(X,{size:"medium"})})}):m?e.jsx("div",{className:"customer-list",children:e.jsxs("div",{className:"customer-list__empty",children:[e.jsx("p",{children:"Error loading customers"}),e.jsx(v,{size:"small",onClick:()=>window.location.reload(),children:"Reload"})]})}):e.jsxs("div",{className:"customer-list",children:[e.jsxs("div",{className:"customer-list__header",children:[e.jsx("h2",{className:"customer-list__title",children:"Customer List"}),e.jsx(v,{variant:"primary",size:"small",onClick:t,children:"+ Add Customer"})]}),e.jsx("div",{className:"customer-list__search",children:e.jsx("input",{type:"text",className:"customer-list__search-input",placeholder:"Search customers...",value:i,onChange:o=>n(o.target.value)})}),e.jsx("div",{className:"customer-list__items",children:c.length===0?e.jsx("div",{className:"customer-list__empty",children:i?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"customer-list__empty-text",children:"No customers found"}),e.jsx(v,{size:"small",variant:"ghost",onClick:()=>n(""),children:"Clear Search"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"customer-list__empty-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsx("p",{className:"customer-list__empty-text",children:"No customers yet"}),e.jsx(v,{size:"small",variant:"primary",onClick:t,children:"Create First Customer"})]})}):c.map(o=>e.jsxs("div",{className:`customer-list__item ${a===o.id?"customer-list__item--active":""}`,onClick:()=>s(o),children:[e.jsx("div",{className:"customer-list__item-avatar avatar",style:{backgroundColor:be(o.name)},children:Ne(o.name)}),e.jsxs("div",{className:"customer-list__item-info",children:[e.jsx("div",{className:"customer-list__item-name",children:o.name}),e.jsx("div",{className:"customer-list__item-phone",children:o.phone})]})]},o.id))})]})},Q=({customer:s,mode:t,onSuccess:a,onCancel:i})=>{const n=fe(),r=_e(),[l,m]=_.useState({name:(s==null?void 0:s.name)||"",phone:(s==null?void 0:s.phone)||"",email:(s==null?void 0:s.email)||"",nric:(s==null?void 0:s.nric)||"",dob:(s==null?void 0:s.dob)||"",occupation:(s==null?void 0:s.occupation)||"",address:(s==null?void 0:s.address)||"",addressContinue:(s==null?void 0:s.addressContinue)||"",salesConsultant:(s==null?void 0:s.salesConsultant)||"",vsaNo:(s==null?void 0:s.vsaNo)||"",dealClosed:(s==null?void 0:s.dealClosed)||!1,notes:(s==null?void 0:s.notes)||""}),[c,o]=_.useState({}),[u,h]=_.useState(!1),[d,N]=_.useState((s==null?void 0:s.checklist)||{nricCollected:!1,testDriveCompleted:!1,vsaSigned:!1,tradeInDocuments:!1,paymentReceived:!1}),x=j=>{const{name:I,value:B,type:Z}=j.target,ee=j.target.checked;m(F=>({...F,[I]:Z==="checkbox"?ee:B})),c[I]&&o(F=>{const q={...F};return delete q[I],q})},f=(j,I)=>{N(B=>({...B,[j]:I}))},w=async j=>{j.preventDefault(),o({});try{t==="create"?await n.mutateAsync({...l,checklist:d}):s&&await r.mutateAsync({customerId:s.id,data:{...l,checklist:d}}),a()}catch(I){console.error("Failed to save customer:",I),o({submit:"Failed to save customer. Please try again."})}},p=n.isPending||r.isPending;return e.jsxs("form",{onSubmit:w,className:"customer-form",children:[e.jsxs("div",{className:"customer-form__section",children:[e.jsx("h3",{className:"customer-form__section-title",children:"Personal Information"}),e.jsxs("div",{className:"customer-form__grid",children:[e.jsx(b,{label:"Full Name",name:"name",value:l.name,onChange:x,error:c.name,required:!0,fullWidth:!0,disabled:p}),e.jsx(b,{label:"Phone Number",name:"phone",type:"tel",value:l.phone,onChange:x,error:c.phone,required:!0,fullWidth:!0,disabled:p}),e.jsx(b,{label:"Email Address",name:"email",type:"email",value:l.email,onChange:x,error:c.email,fullWidth:!0,disabled:p}),e.jsx(b,{label:"NRIC",name:"nric",value:l.nric,onChange:x,error:c.nric,helperText:"Format: S1234567A",required:!0,fullWidth:!0,disabled:p}),e.jsx(b,{label:"Date of Birth",name:"dob",type:"date",value:l.dob,onChange:x,error:c.dob,required:!0,fullWidth:!0,disabled:p}),e.jsx(b,{label:"Occupation",name:"occupation",value:l.occupation,onChange:x,error:c.occupation,fullWidth:!0,disabled:p})]})]}),e.jsxs("div",{className:"customer-form__section",children:[e.jsx("h3",{className:"customer-form__section-title",children:"Address"}),e.jsxs("div",{className:"customer-form__grid",children:[e.jsx(b,{label:"Address Line 1",name:"address",value:l.address,onChange:x,error:c.address,required:!0,fullWidth:!0,disabled:p}),e.jsx(b,{label:"Address Line 2",name:"addressContinue",value:l.addressContinue,onChange:x,error:c.addressContinue,fullWidth:!0,disabled:p})]})]}),e.jsxs("div",{className:"customer-form__section",children:[e.jsx("h3",{className:"customer-form__section-title",children:"Sales Information"}),e.jsxs("div",{className:"customer-form__grid",children:[e.jsx(b,{label:"Sales Consultant",name:"salesConsultant",value:l.salesConsultant,onChange:x,error:c.salesConsultant,required:!0,fullWidth:!0,disabled:p}),e.jsx(b,{label:"VSA Number",name:"vsaNo",value:l.vsaNo,onChange:x,error:c.vsaNo,helperText:"Vehicle Sales Agreement number",fullWidth:!0,disabled:p}),e.jsx("div",{className:"customer-form__checkbox",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",name:"dealClosed",checked:l.dealClosed,onChange:x,disabled:p}),e.jsx("span",{children:"Deal Closed"})]})})]})]}),e.jsxs("div",{className:"customer-form__section",children:[e.jsxs("div",{className:"customer-form__section-header",children:[e.jsx("h3",{className:"customer-form__section-title",children:"Checklist"}),e.jsx(v,{type:"button",variant:"ghost",size:"small",onClick:()=>h(!u),children:u?"Hide":"Show"})]}),u&&e.jsxs("div",{className:"customer-form__checklist",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:d.nricCollected,onChange:j=>f("nricCollected",j.target.checked),disabled:p}),e.jsx("span",{children:"NRIC Collected"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:d.testDriveCompleted,onChange:j=>f("testDriveCompleted",j.target.checked),disabled:p}),e.jsx("span",{children:"Test Drive Completed"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:d.vsaSigned,onChange:j=>f("vsaSigned",j.target.checked),disabled:p}),e.jsx("span",{children:"VSA Signed"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:d.tradeInDocuments,onChange:j=>f("tradeInDocuments",j.target.checked),disabled:p}),e.jsx("span",{children:"Trade-In Documents Received"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:d.paymentReceived,onChange:j=>f("paymentReceived",j.target.checked),disabled:p}),e.jsx("span",{children:"Payment Received"})]})]})]}),e.jsx("div",{className:"customer-form__section",children:e.jsx(J,{label:"Notes",name:"notes",value:l.notes,onChange:x,error:c.notes,rows:4,fullWidth:!0,disabled:p})}),c.submit&&e.jsx("div",{className:"customer-form__error",children:c.submit}),e.jsxs("div",{className:"customer-form__actions",children:[e.jsx(v,{type:"button",variant:"ghost",onClick:i,disabled:p,children:"Cancel"}),e.jsx(v,{type:"submit",variant:"primary",loading:p,children:t==="create"?"Create Customer":"Save Changes"})]})]})},we=({customerId:s,onEdit:t,onBack:a,onDeleted:i})=>{const{data:n,isLoading:r,error:l}=ge(s),m=je(),c=ve(),[o,u]=_.useState("details"),[h,d]=_.useState(!1),N=async()=>{try{await m.mutateAsync(s),d(!1),i()}catch(f){console.error("Failed to delete customer:",f)}},x=async(f,w)=>{if(n)try{await c.mutateAsync({customerId:s,key:f,value:w})}catch(p){console.error("Failed to update checklist:",p)}};return r?e.jsx("div",{className:"customer-details__loading",children:e.jsx(X,{size:"large",label:"Loading customer details..."})}):l||!n?e.jsxs("div",{className:"customer-details__error",children:[e.jsx("p",{children:"Error loading customer details. Please try again."}),e.jsx(v,{onClick:a,children:"Go Back"})]}):e.jsxs("div",{className:"customer-details",children:[e.jsxs("div",{className:"customer-details__header",children:[e.jsx("h1",{className:"customer-details__name",children:n.name}),e.jsxs("div",{className:"customer-details__actions",children:[e.jsx(v,{variant:"primary",size:"medium",children:"Print Form"}),e.jsx(v,{variant:"primary",size:"medium",children:"Combine & Print"}),e.jsx(v,{variant:"primary",size:"medium",children:"Populate Excel"})]})]}),e.jsxs("div",{className:"customer-details__tabs tabs",children:[e.jsx("button",{className:`tab ${o==="details"?"tab-active":""}`,onClick:()=>u("details"),children:"Details"}),e.jsx("button",{className:`tab ${o==="proposal"?"tab-active":""}`,onClick:()=>u("proposal"),children:"Proposal"}),e.jsx("button",{className:`tab ${o==="vsa"?"tab-active":""}`,onClick:()=>u("vsa"),children:"VSA"}),e.jsx("button",{className:`tab ${o==="documents"?"tab-active":""}`,onClick:()=>u("documents"),children:"Documents"}),e.jsx("button",{className:`tab ${o==="scanner"?"tab-active":""}`,onClick:()=>u("scanner"),children:"Scanner"})]}),e.jsxs("div",{className:"customer-details__content",children:[o==="details"&&e.jsxs("div",{className:"customer-details__tab-panel",children:[e.jsx("div",{className:"customer-details__info-header",children:e.jsx(v,{variant:"primary",size:"medium",onClick:()=>t(n),children:"Edit Details"})}),e.jsxs("div",{className:"customer-details__grid",children:[e.jsxs("div",{className:"customer-details__section",children:[e.jsx("h3",{className:"customer-details__section-title",children:"Personal Information"}),e.jsxs("div",{className:"customer-details__fields",children:[e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Phone"}),e.jsx("span",{className:"customer-details__field-value",children:e.jsx("a",{href:`tel:${n.phone}`,children:n.phone})})]}),n.email&&e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Email"}),e.jsx("span",{className:"customer-details__field-value",children:e.jsx("a",{href:`mailto:${n.email}`,children:n.email})})]}),e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"NRIC"}),e.jsx("span",{className:"customer-details__field-value",children:n.nric})]}),e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Date of Birth"}),e.jsx("span",{className:"customer-details__field-value",children:new Date(n.dob).toLocaleDateString()})]}),n.occupation&&e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Occupation"}),e.jsx("span",{className:"customer-details__field-value",children:n.occupation})]})]})]}),e.jsxs("div",{className:"customer-details__section",children:[e.jsx("h3",{className:"customer-details__section-title",children:"Address"}),e.jsx("div",{className:"customer-details__fields",children:e.jsx("div",{className:"customer-details__field",children:e.jsxs("span",{className:"customer-details__field-value",children:[n.address,n.addressContinue&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),n.addressContinue]})]})})})]}),e.jsxs("div",{className:"customer-details__section",children:[e.jsx("h3",{className:"customer-details__section-title",children:"Sales Information"}),e.jsxs("div",{className:"customer-details__fields",children:[e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Sales Consultant"}),e.jsx("span",{className:"customer-details__field-value",children:n.salesConsultant})]}),n.vsaNo&&e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"VSA Number"}),e.jsx("span",{className:"customer-details__field-value",children:n.vsaNo})]})]})]}),e.jsxs("div",{className:"customer-details__section customer-details__section--full",children:[e.jsx("h3",{className:"customer-details__section-title",children:"Checklist"}),e.jsx("div",{className:"customer-details__checklist",children:Object.entries(n.checklist).map(([f,w])=>e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:p=>x(f,p.target.checked)}),e.jsx("span",{children:Se(f)})]},f))})]}),n.notes&&e.jsxs("div",{className:"customer-details__section customer-details__section--full",children:[e.jsx("h3",{className:"customer-details__section-title",children:"Notes"}),e.jsx("div",{className:"customer-details__notes",children:n.notes})]}),n.driveFolderLink&&e.jsxs("div",{className:"customer-details__section customer-details__section--full",children:[e.jsx("h3",{className:"customer-details__section-title",children:"Google Drive"}),e.jsx("div",{className:"customer-details__fields",children:e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Folder"}),e.jsx("span",{className:"customer-details__field-value",children:e.jsx("a",{href:n.driveFolderLink,target:"_blank",rel:"noopener noreferrer",children:"Open in Google Drive"})})]})})]}),e.jsxs("div",{className:"customer-details__section customer-details__section--full",children:[e.jsx("h3",{className:"customer-details__section-title",children:"Record Information"}),e.jsxs("div",{className:"customer-details__fields",children:[e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Created"}),e.jsx("span",{className:"customer-details__field-value",children:new Date(n.createdAt).toLocaleString()})]}),e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Last Updated"}),e.jsx("span",{className:"customer-details__field-value",children:new Date(n.updatedAt).toLocaleString()})]})]})]})]}),e.jsx("div",{className:"customer-details__danger-zone",children:e.jsx(v,{variant:"danger",size:"medium",onClick:()=>d(!0),children:"Delete Customer"})})]}),o==="proposal"&&e.jsx("div",{className:"customer-details__tab-panel",children:e.jsx("p",{className:"customer-details__placeholder",children:"Proposal feature coming soon..."})}),o==="vsa"&&e.jsx("div",{className:"customer-details__tab-panel",children:e.jsx("p",{className:"customer-details__placeholder",children:"VSA feature coming soon..."})}),o==="documents"&&e.jsx("div",{className:"customer-details__tab-panel",children:e.jsx("p",{className:"customer-details__placeholder",children:"Documents feature coming soon..."})}),o==="scanner"&&e.jsx("div",{className:"customer-details__tab-panel",children:e.jsx("p",{className:"customer-details__placeholder",children:"Scanner feature coming soon..."})})]}),e.jsx(Ce,{isOpen:h,onClose:()=>d(!1),title:"Delete Customer",size:"small",children:e.jsxs("div",{className:"customer-details__delete-modal",children:[e.jsxs("p",{children:["Are you sure you want to delete ",e.jsx("strong",{children:n.name}),"? This action cannot be undone."]}),e.jsxs("div",{className:"customer-details__delete-actions",children:[e.jsx(v,{variant:"ghost",onClick:()=>d(!1),children:"Cancel"}),e.jsx(v,{variant:"danger",onClick:N,loading:m.isPending,children:"Delete Customer"})]})]})})]})};function Se(s){return{nricCollected:"NRIC Collected",testDriveCompleted:"Test Drive Completed",vsaSigned:"VSA Signed",tradeInDocuments:"Trade-In Documents Received",paymentReceived:"Payment Received"}[s]||s}function K(){const{isSignedIn:s,isInitialized:t,isLoading:a,signIn:i,signOut:n,consultant:r}=he(),[l,m]=_.useState("list"),[c,o]=_.useState(null);if(_.useEffect(()=>{console.log("Dashboard mounted"),console.log("Auth state:",{isSignedIn:s,isInitialized:t,isLoading:a})},[s,t,a]),!t||a)return e.jsx("div",{className:"dashboard",children:e.jsxs("div",{className:"dashboard-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading BYD CRM..."})]})});if(!s)return e.jsx("div",{className:"dashboard",children:e.jsx("div",{className:"dashboard-signin",children:e.jsxs("div",{className:"signin-card",children:[e.jsx("h1",{children:"BYD CRM"}),e.jsx("p",{children:"Customer Relationship Management System"}),e.jsx("p",{className:"signin-subtitle",children:"Sign in with your Google account to access your customer data"}),e.jsxs("button",{className:"btn-signin",onClick:i,children:[e.jsxs("svg",{width:"18",height:"18",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",children:[e.jsx("path",{fill:"#EA4335",d:"M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"}),e.jsx("path",{fill:"#4285F4",d:"M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"}),e.jsx("path",{fill:"#FBBC05",d:"M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"}),e.jsx("path",{fill:"#34A853",d:"M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"})]}),"Sign in with Google"]})]})})});const u=w=>{o(w),m("details")},h=()=>{o(null),m("create")},d=w=>{o(w),m("edit")},N=()=>{o(null),m("list")},x=()=>{o(null),m("list")},f=()=>{o(null),m("list")};return e.jsxs("div",{className:"dashboard",children:[e.jsx("header",{className:"dashboard-header",children:e.jsxs("div",{className:"header-content",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{children:"BYD CRM"}),l!=="list"&&e.jsxs("span",{className:"header-breadcrumb",children:[l==="create"&&"/ New Customer",l==="edit"&&`/ Edit: ${c==null?void 0:c.name}`,l==="details"&&`/ ${c==null?void 0:c.name}`]})]}),e.jsxs("div",{className:"header-user",children:[e.jsx("img",{src:r==null?void 0:r.picture,alt:r==null?void 0:r.name,className:"user-avatar"}),e.jsx("span",{className:"user-name",children:r==null?void 0:r.name}),e.jsx(v,{variant:"ghost",size:"small",onClick:n,children:"Sign Out"})]})]})}),e.jsxs("main",{className:"dashboard-main",children:[l==="list"&&e.jsx(ye,{onSelectCustomer:u,onCreateCustomer:h}),l==="create"&&e.jsxs("div",{className:"dashboard-form-container",children:[e.jsx("h2",{className:"dashboard-form-title",children:"Create New Customer"}),e.jsx(Q,{mode:"create",onSuccess:x,onCancel:f})]}),l==="edit"&&c&&e.jsxs("div",{className:"dashboard-form-container",children:[e.jsx("h2",{className:"dashboard-form-title",children:"Edit Customer"}),e.jsx(Q,{customer:c,mode:"edit",onSuccess:x,onCancel:f})]}),l==="details"&&c&&e.jsx(we,{customerId:c.id,onEdit:d,onBack:N,onDeleted:N})]})]})}const Ie=new ne({defaultOptions:{queries:{staleTime:5*60*1e3,retry:3}}});function Ee(){return _.useEffect(()=>{const{valid:s,errors:t}=de();s?console.log("âœ… Configuration valid"):(console.error("âŒ Configuration errors:",t),t.forEach(a=>console.error(`  - ${a}`))),console.log(`ğŸš€ ${k.APP.NAME} v${k.APP.VERSION}`),console.log(`ğŸŒ Environment: ${k.APP.ENV}`)},[]),e.jsx(ie,{client:Ie,children:e.jsx(re,{basename:"/BYD-CRM-2",children:e.jsxs(le,{children:[e.jsx(Y,{path:"/",element:e.jsx(K,{})}),e.jsx(Y,{path:"*",element:e.jsx(K,{})})]})})})}M.createRoot(document.getElementById("root")).render(e.jsx(oe.StrictMode,{children:e.jsx(Ee,{})}));
//# sourceMappingURL=index-DPXqwe9O.js.map
