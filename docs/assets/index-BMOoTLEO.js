var ae=Object.defineProperty;var ne=(s,a,t)=>a in s?ae(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t;var w=(s,a,t)=>ne(s,typeof a!="symbol"?a+"":a,t);import{c as re,u as $,a as F,b as B,j as e,Q as ie,d as le}from"./vendor-state-HHgQU-Dp.js";import{a as J,r as j,B as oe,b as ce,d as Q,R as de}from"./vendor-react-D_6SLu_M.js";import{D as ue}from"./vendor-db-Z29b7Thg.js";import{o as X,b as P,s as f,r as U,l as D,n as W}from"./vendor-utils-BN0HniSu.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();var z={},K=J;z.createRoot=K.createRoot,z.hydrateRoot=K.hydrateRoot;const A={GOOGLE:{CLIENT_ID:"73506d815688-uu7mg0b5br9irg44pmk5jj2ak6hjkbdn.apps.googleusercontent.com",API_KEY:"AIzaSyACKCQxdn-b7fDCfsbG2xqS-i36fenTcc",SCOPES:["https://www.googleapis.com/auth/drive","https://www.googleapis.com/auth/drive.appdata"].join(" "),DISCOVERY_DOCS:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]},DRIVE_FOLDERS:{ROOT:"BYD CRM",CUSTOMERS_DATA:"BYD Customers Data",FORMS:"BYD CRM - Form Templates",EXCEL:"BYD CRM - Excel Templates",CUSTOMER_SUBFOLDERS:["NRIC","Test Drive","VSA","Trade In","Other Documents"]},SYNC:{BATCH_SIZE:10,RETRY_LIMIT:3,RETRY_DELAY:1e3,AUTO_SYNC_INTERVAL:5*60*1e3,TIMEOUT:3e4},ENCRYPTION:{SALT:"r0h/xM9JXK/AAblYO0mdtS27/nFWwu4xKB8rp/+z83k=",ALGORITHM:"AES"},UI:{ITEMS_PER_PAGE:20,DEBOUNCE_DELAY:300,TOAST_DURATION:3e3,MAX_FILE_SIZE:10*1024*1024},APP:{NAME:"BYD CRM",VERSION:"2.0.0",ENV:"development"},FEATURES:{OFFLINE_MODE:!0,AUTO_SYNC:!0,DATA_ENCRYPTION:!0,DEBUG_MODE:!1}};function he(){const s=[];return{valid:s.length===0,errors:s}}const E=class E{constructor(){w(this,"gapi",null);w(this,"auth",null);w(this,"isInitialized",!1)}static getInstance(){return E.instance||(E.instance=new E),E.instance}async init(){if(!this.isInitialized)return new Promise((a,t)=>{if(window.gapi){this.loadAuth(a,t);return}const r=document.createElement("script");r.src="https://apis.google.com/js/api.js",r.async=!0,r.defer=!0,r.onload=()=>{this.loadAuth(a,t)},r.onerror=()=>{t(new Error("Failed to load Google API script"))},document.body.appendChild(r)})}loadAuth(a,t){gapi.load("client:auth2",async()=>{try{await gapi.client.init({apiKey:A.GOOGLE.API_KEY,clientId:A.GOOGLE.CLIENT_ID,discoveryDocs:A.GOOGLE.DISCOVERY_DOCS,scope:A.GOOGLE.SCOPES}),this.gapi=gapi,this.auth=gapi.auth2.getAuthInstance(),this.isInitialized=!0,console.log("âœ… Google API initialized"),a()}catch(r){console.error("âŒ Failed to initialize Google API:",r),t(r instanceof Error?r:new Error("Failed to initialize Google API"))}})}async signIn(){if(!this.auth)throw new Error("Google Auth not initialized. Call init() first.");try{const t=(await this.auth.signIn()).getBasicProfile(),r={id:t.getId(),email:t.getEmail(),name:t.getName(),picture:t.getImageUrl()};return sessionStorage.setItem("consultant",JSON.stringify(r)),console.log("âœ… Signed in as:",r.email),r}catch(a){throw console.error("âŒ Sign in failed:",a),new Error("Failed to sign in with Google")}}async signOut(){if(!this.auth)throw new Error("Google Auth not initialized");try{await this.auth.signOut(),sessionStorage.removeItem("consultant"),console.log("âœ… Signed out")}catch(a){throw console.error("âŒ Sign out failed:",a),new Error("Failed to sign out")}}isSignedIn(){var a;return((a=this.auth)==null?void 0:a.isSignedIn.get())??!1}getCurrentConsultant(){const a=sessionStorage.getItem("consultant");if(!a)return null;try{return JSON.parse(a)}catch{return null}}getAccessToken(){var t;const a=(t=this.auth)==null?void 0:t.currentUser.get();return(a==null?void 0:a.getAuthResponse().access_token)??""}onAuthStateChange(a){if(!this.auth)return console.warn("Auth not initialized, cannot listen to state changes"),()=>{};const t=this.auth.isSignedIn.listen(a);return()=>{console.log("Cleaned up auth listener:",t)}}getIsInitialized(){return this.isInitialized}};w(E,"instance");let Y=E;const N=Y.getInstance();class me extends ue{constructor(){super("BYD_CRM_DB");w(this,"customers");w(this,"formTemplates");w(this,"excelTemplates");w(this,"syncQueue");this.version(1).stores({customers:"id, consultantId, name, createdAt, updatedAt, dealClosed",formTemplates:"id, consultantId, name, createdAt",excelTemplates:"id, consultantId, name, createdAt",syncQueue:"id, consultantId, status, entityType, createdAt"})}async clearConsultantData(t){await this.transaction("rw",[this.customers,this.formTemplates,this.excelTemplates,this.syncQueue],async()=>{await this.customers.where("consultantId").equals(t).delete(),await this.formTemplates.where("consultantId").equals(t).delete(),await this.excelTemplates.where("consultantId").equals(t).delete(),await this.syncQueue.where("consultantId").equals(t).delete()})}async getStats(t){return{customers:await this.customers.where("consultantId").equals(t).count(),forms:await this.formTemplates.where("consultantId").equals(t).count(),excel:await this.excelTemplates.where("consultantId").equals(t).count(),pendingSync:await this.syncQueue.where({consultantId:t,status:"pending"}).count()}}}const I=new me,xe=re((s,a)=>({consultant:null,isInitialized:!1,isSignedIn:!1,isLoading:!1,error:null,init:async()=>{try{s({isLoading:!0,error:null}),await N.init();const t=N.isSignedIn(),r=t?N.getCurrentConsultant():null;s({isInitialized:!0,isSignedIn:t,consultant:r,isLoading:!1}),console.log("âœ… Auth initialized, signed in:",t)}catch(t){const r=t instanceof Error?t.message:"Failed to initialize auth";s({isInitialized:!0,isLoading:!1,error:r}),console.error("âŒ Auth initialization failed:",r)}},signIn:async()=>{try{s({isLoading:!0,error:null});const t=await N.signIn();s({consultant:t,isSignedIn:!0,isLoading:!1}),console.log("âœ… Signed in successfully")}catch(t){const r=t instanceof Error?t.message:"Failed to sign in";throw s({isLoading:!1,error:r}),console.error("âŒ Sign in failed:",r),t}},signOut:async()=>{try{s({isLoading:!0,error:null});const t=a().consultant;await N.signOut(),t&&(await I.clearConsultantData(t.id),console.log("âœ… Cleared local data for consultant:",t.id)),s({consultant:null,isSignedIn:!1,isLoading:!1}),console.log("âœ… Signed out successfully")}catch(t){const r=t instanceof Error?t.message:"Failed to sign out";throw s({isLoading:!1,error:r}),console.error("âŒ Sign out failed:",r),t}},clearError:()=>s({error:null})}));function pe(){const s=xe();return j.useEffect(()=>{s.isInitialized||s.init()},[s.isInitialized,s.init]),{consultant:s.consultant,isSignedIn:s.isSignedIn,isInitialized:s.isInitialized,isLoading:s.isLoading,error:s.error,signIn:s.signIn,signOut:s.signOut,clearError:s.clearError,isReady:s.isInitialized&&!s.isLoading}}const T=X({id:f().uuid(),consultantId:f().min(1,"Consultant ID required"),name:f().min(2,"Name must be at least 2 characters").max(100,"Name must be less than 100 characters").trim(),phone:f().regex(/^\+?[0-9\s-()]+$/,"Invalid phone number format").min(8,"Phone number too short").max(20,"Phone number too long").trim(),email:f().email("Invalid email address").optional().or(D("")).transform(s=>s===""?void 0:s),nric:f().regex(/^[STFG]\d{7}[A-Z]$/,"Invalid NRIC format (e.g., S1234567A)").toUpperCase().trim(),dob:f().regex(/^\d{4}-\d{2}-\d{2}$/,"Date must be in YYYY-MM-DD format"),occupation:f().max(100,"Occupation too long").optional().or(D("")).transform(s=>s===""?void 0:s),address:f().min(5,"Address must be at least 5 characters").max(200,"Address too long").trim(),addressContinue:f().max(200,"Address continuation too long").optional().or(D("")).transform(s=>s===""?void 0:s),salesConsultant:f().min(2,"Sales consultant name required").trim(),vsaNo:f().optional().or(D("")).transform(s=>s===""?void 0:s),dealClosed:P().default(!1),driveFolderId:f().optional(),driveFolderLink:f().url().optional().or(D("")).transform(s=>s===""?void 0:s),subfolders:U(f()).optional(),notes:f().max(2e3,"Notes too long").optional().or(D("")).transform(s=>s===""?void 0:s),checklist:U(P()).default({}),createdAt:f().datetime(),updatedAt:f().datetime(),encrypted:P().default(!1)});T.omit({id:!0,consultantId:!0,createdAt:!0,updatedAt:!0,encrypted:!0,driveFolderId:!0,driveFolderLink:!0,subfolders:!0});T.partial().required({id:!0});X({query:f().min(1,"Search query required"),limit:W().min(1).max(100).default(20),offset:W().min(0).default(0)});class ge{async getAll(){const a=N.getCurrentConsultant();if(!a)throw new Error("Not authenticated");return I.customers.where("consultantId").equals(a.id).reverse().sortBy("createdAt")}async getById(a){const t=N.getCurrentConsultant();if(!t)throw new Error("Not authenticated");const r=await I.customers.get(a);if(r&&r.consultantId!==t.id)throw new Error("Unauthorized: Cannot access another consultant's customer");return r||null}async create(a){const t=N.getCurrentConsultant();if(!t)throw new Error("Not authenticated");const r=crypto.randomUUID(),n={...a,id:r,consultantId:t.id,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),encrypted:!1,checklist:a.checklist||{},dealClosed:a.dealClosed||!1},i=T.parse(n);return await I.customers.add(i),console.log("âœ… Customer created:",i.id),i}async update(a,t){const r=N.getCurrentConsultant();if(!r)throw new Error("Not authenticated");const n=await this.getById(a);if(!n)throw new Error("Customer not found");const i={...n,...t,id:a,consultantId:r.id,updatedAt:new Date().toISOString()},l=T.parse(i);return await I.customers.put(l),console.log("âœ… Customer updated:",l.id),l}async delete(a){if(!N.getCurrentConsultant())throw new Error("Not authenticated");if(!await this.getById(a))throw new Error("Customer not found");await I.customers.delete(a),console.log("âœ… Customer deleted:",a)}async search(a){if(!N.getCurrentConsultant())throw new Error("Not authenticated");const r=await this.getAll(),n=a.toLowerCase().trim();return n?r.filter(i=>{var l,h;return i.name.toLowerCase().includes(n)||i.phone.includes(a)||((l=i.email)==null?void 0:l.toLowerCase().includes(n))||i.nric.toLowerCase().includes(n)||((h=i.vsaNo)==null?void 0:h.toLowerCase().includes(n))}):r}async getByDealStatus(a){const t=N.getCurrentConsultant();if(!t)throw new Error("Not authenticated");return I.customers.where({consultantId:t.id,dealClosed:a}).reverse().sortBy("updatedAt")}async toggleDealClosed(a){const t=await this.getById(a);if(!t)throw new Error("Customer not found");return this.update(a,{dealClosed:!t.dealClosed})}async updateChecklistItem(a,t,r){const n=await this.getById(a);if(!n)throw new Error("Customer not found");const i={...n.checklist,[t]:r};return this.update(a,{checklist:i})}async getStats(){if(!N.getCurrentConsultant())throw new Error("Not authenticated");const t=await this.getAll();return{total:t.length,open:t.filter(r=>!r.dealClosed).length,closed:t.filter(r=>r.dealClosed).length}}}const k=new ge,b={customers:["customers"],customer:s=>["customers",s],stats:["customers","stats"],search:s=>["customers","search",s]},fe=()=>$({queryKey:b.customers,queryFn:()=>k.getAll()}),je=s=>$({queryKey:b.customer(s),queryFn:()=>k.getById(s),enabled:!!s}),_e=()=>$({queryKey:b.stats,queryFn:()=>k.getStats()}),Ce=()=>{const s=F();return B({mutationFn:a=>k.create(a),onSuccess:()=>{s.invalidateQueries({queryKey:b.customers}),s.invalidateQueries({queryKey:b.stats})}})},ve=()=>{const s=F();return B({mutationFn:({customerId:a,data:t})=>k.update(a,t),onSuccess:(a,t)=>{s.invalidateQueries({queryKey:b.customers}),s.invalidateQueries({queryKey:b.customer(t.customerId)}),s.invalidateQueries({queryKey:b.stats})}})},Ne=()=>{const s=F();return B({mutationFn:a=>k.delete(a),onSuccess:()=>{s.invalidateQueries({queryKey:b.customers}),s.invalidateQueries({queryKey:b.stats})}})},ye=()=>{const s=F();return B({mutationFn:({customerId:a,key:t,value:r})=>k.updateChecklistItem(a,t,r),onSuccess:(a,t)=>{s.invalidateQueries({queryKey:b.customers}),s.invalidateQueries({queryKey:b.customer(t.customerId)})}})},C=({variant:s="primary",size:a="medium",loading:t=!1,fullWidth:r=!1,disabled:n,children:i,className:l="",...h})=>{const o=["btn",`btn--${s}`,`btn--${a}`,r&&"btn--full-width",t&&"btn--loading",l].filter(Boolean).join(" ");return e.jsxs("button",{className:o,disabled:n||t,...h,children:[t&&e.jsx("span",{className:"btn__spinner","aria-hidden":"true",children:e.jsx("svg",{className:"btn__spinner-svg",viewBox:"0 0 24 24",children:e.jsx("circle",{className:"btn__spinner-circle",cx:"12",cy:"12",r:"10",fill:"none",strokeWidth:"3"})})}),e.jsx("span",{className:t?"btn__text--hidden":"btn__text",children:i})]})},y=j.forwardRef(({label:s,error:a,helperText:t,fullWidth:r=!1,leftIcon:n,rightIcon:i,className:l="",id:h,required:o,disabled:u,...x},c)=>{const d=h||`input-${Math.random().toString(36).substr(2,9)}`,m=!!a,p=["input-wrapper",r&&"input-wrapper--full-width",u&&"input-wrapper--disabled"].filter(Boolean).join(" "),_=["input",m&&"input--error",n&&"input--has-left-icon",i&&"input--has-right-icon",l].filter(Boolean).join(" ");return e.jsxs("div",{className:p,children:[s&&e.jsxs("label",{htmlFor:d,className:"input-label",children:[s,o&&e.jsx("span",{className:"input-label__required",children:"*"})]}),e.jsxs("div",{className:"input-container",children:[n&&e.jsx("span",{className:"input-icon input-icon--left",children:n}),e.jsx("input",{ref:c,id:d,className:_,disabled:u,"aria-invalid":m,"aria-describedby":a?`${d}-error`:t?`${d}-helper`:void 0,...x}),i&&e.jsx("span",{className:"input-icon input-icon--right",children:i})]}),a&&e.jsx("p",{id:`${d}-error`,className:"input-message input-message--error",children:a}),!a&&t&&e.jsx("p",{id:`${d}-helper`,className:"input-message input-message--helper",children:t})]})});y.displayName="Input";const Z=j.forwardRef(({label:s,error:a,helperText:t,fullWidth:r=!1,className:n="",id:i,required:l,disabled:h,...o},u)=>{const x=i||`textarea-${Math.random().toString(36).substr(2,9)}`,c=!!a,d=["input-wrapper",r&&"input-wrapper--full-width",h&&"input-wrapper--disabled"].filter(Boolean).join(" "),m=["input",c&&"input--error",n].filter(Boolean).join(" ");return e.jsxs("div",{className:d,children:[s&&e.jsxs("label",{htmlFor:x,className:"input-label",children:[s,l&&e.jsx("span",{className:"input-label__required",children:"*"})]}),e.jsx("textarea",{ref:u,id:x,className:m,disabled:h,"aria-invalid":c,"aria-describedby":a?`${x}-error`:t?`${x}-helper`:void 0,...o}),a&&e.jsx("p",{id:`${x}-error`,className:"input-message input-message--error",children:a}),!a&&t&&e.jsx("p",{id:`${x}-helper`,className:"input-message input-message--helper",children:t})]})});Z.displayName="Textarea";const be=({isOpen:s,onClose:a,title:t,children:r,size:n="medium",showCloseButton:i=!0,closeOnOverlayClick:l=!0,closeOnEscape:h=!0})=>{const o=j.useRef(null);if(j.useEffect(()=>{const c=d=>{h&&d.key==="Escape"&&s&&a()};return s&&(document.addEventListener("keydown",c),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",c),document.body.style.overflow=""}},[s,a,h]),j.useEffect(()=>{if(s&&o.current){const d=o.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')[0];d==null||d.focus()}},[s]),!s)return null;const u=c=>{l&&c.target===c.currentTarget&&a()},x=e.jsx("div",{className:"modal-overlay",onClick:u,role:"dialog","aria-modal":"true",children:e.jsxs("div",{ref:o,className:`modal modal--${n}`,children:[(t||i)&&e.jsxs("div",{className:"modal__header",children:[t&&e.jsx("h2",{className:"modal__title",children:t}),i&&e.jsx("button",{type:"button",className:"modal__close",onClick:a,"aria-label":"Close modal",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsx("div",{className:"modal__content",children:r})]})});return J.createPortal(x,document.body)},ee=({size:s="medium",color:a="primary",fullScreen:t=!1,label:r="Loading..."})=>{const n=e.jsxs("div",{className:`spinner spinner--${s} spinner--${a}`,role:"status",children:[e.jsx("svg",{className:"spinner__svg",viewBox:"0 0 50 50",children:e.jsx("circle",{className:"spinner__circle",cx:"25",cy:"25",r:"20",fill:"none",strokeWidth:"4"})}),e.jsx("span",{className:"spinner__label",children:r})]});return t?e.jsx("div",{className:"spinner-container spinner-container--fullscreen",children:n}):n},L=({children:s,className:a="",hover:t=!1,onClick:r})=>{const n=["card",t&&"card--hover",r&&"card--clickable",a].filter(Boolean).join(" "),i=r?"button":"div";return e.jsx(i,{className:n,onClick:r,type:r?"button":void 0,children:s})},we=({children:s,className:a=""})=>e.jsx("div",{className:`card__header ${a}`,children:s}),R=({children:s,className:a=""})=>e.jsx("div",{className:`card__body ${a}`,children:s}),Se=({onSelectCustomer:s,onCreateCustomer:a})=>{const[t,r]=j.useState(""),[n,i]=j.useState("all"),{data:l=[],isLoading:h,error:o}=fe(),{data:u}=_e(),x=j.useMemo(()=>{let c=[...l];if(t.trim()){const d=t.toLowerCase();c=c.filter(m=>{var p,_;return m.name.toLowerCase().includes(d)||m.phone.includes(d)||((p=m.email)==null?void 0:p.toLowerCase().includes(d))||m.nric.toLowerCase().includes(d)||((_=m.vsaNo)==null?void 0:_.toLowerCase().includes(d))})}return n!=="all"&&(c=c.filter(d=>n==="closed"?d.dealClosed:!d.dealClosed)),c.sort((d,m)=>new Date(m.createdAt).getTime()-new Date(d.createdAt).getTime()),c},[l,t,n]);return h?e.jsx("div",{className:"customer-list__loading",children:e.jsx(ee,{size:"large",label:"Loading customers..."})}):o?e.jsxs("div",{className:"customer-list__error",children:[e.jsx("p",{children:"Error loading customers. Please try again."}),e.jsx(C,{onClick:()=>window.location.reload(),children:"Reload"})]}):e.jsxs("div",{className:"customer-list",children:[u&&e.jsxs("div",{className:"customer-list__stats",children:[e.jsx(L,{className:"stat-card",children:e.jsxs(R,{children:[e.jsx("div",{className:"stat-card__value",children:u.total}),e.jsx("div",{className:"stat-card__label",children:"Total Customers"})]})}),e.jsx(L,{className:"stat-card",children:e.jsxs(R,{children:[e.jsx("div",{className:"stat-card__value",children:u.closed}),e.jsx("div",{className:"stat-card__label",children:"Deals Closed"})]})}),e.jsx(L,{className:"stat-card",children:e.jsxs(R,{children:[e.jsx("div",{className:"stat-card__value",children:u.open}),e.jsx("div",{className:"stat-card__label",children:"Open Deals"})]})}),e.jsx(L,{className:"stat-card",children:e.jsxs(R,{children:[e.jsxs("div",{className:"stat-card__value",children:[u.total>0?Math.round(u.closed/u.total*100):0,"%"]}),e.jsx("div",{className:"stat-card__label",children:"Conversion Rate"})]})})]}),e.jsxs("div",{className:"customer-list__controls",children:[e.jsx(y,{type:"text",placeholder:"Search by name, phone, email, NRIC, or VSA...",value:t,onChange:c=>r(c.target.value),fullWidth:!0,leftIcon:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.35-4.35"})]})}),e.jsxs("div",{className:"customer-list__filters",children:[e.jsxs(C,{variant:n==="all"?"primary":"ghost",onClick:()=>i("all"),children:["All (",l.length,")"]}),e.jsxs(C,{variant:n==="open"?"primary":"ghost",onClick:()=>i("open"),children:["Open (",(u==null?void 0:u.open)||0,")"]}),e.jsxs(C,{variant:n==="closed"?"primary":"ghost",onClick:()=>i("closed"),children:["Closed (",(u==null?void 0:u.closed)||0,")"]})]}),e.jsx(C,{variant:"primary",onClick:a,children:"+ New Customer"})]}),x.length===0?e.jsx("div",{className:"customer-list__empty",children:t||n!=="all"?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"No customers found matching your filters."}),e.jsx(C,{variant:"ghost",onClick:()=>{r(""),i("all")},children:"Clear Filters"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"No customers yet. Create your first customer to get started."}),e.jsx(C,{variant:"primary",onClick:a,children:"+ Create First Customer"})]})}):e.jsx("div",{className:"customer-list__grid",children:x.map(c=>e.jsx(L,{hover:!0,onClick:()=>s(c),className:"customer-card",children:e.jsxs(R,{children:[e.jsxs("div",{className:"customer-card__header",children:[e.jsx("h3",{className:"customer-card__name",children:c.name}),e.jsx("span",{className:`customer-card__badge ${c.dealClosed?"customer-card__badge--closed":"customer-card__badge--open"}`,children:c.dealClosed?"Closed":"Open"})]}),e.jsxs("div",{className:"customer-card__details",children:[e.jsxs("div",{className:"customer-card__detail",children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"})}),e.jsx("span",{children:c.phone})]}),c.email&&e.jsxs("div",{className:"customer-card__detail",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}),e.jsx("polyline",{points:"22,6 12,13 2,6"})]}),e.jsx("span",{children:c.email})]}),e.jsxs("div",{className:"customer-card__detail",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),e.jsxs("span",{children:["Created ",new Date(c.createdAt).toLocaleDateString()]})]})]}),c.vsaNo&&e.jsxs("div",{className:"customer-card__vsa",children:[e.jsx("strong",{children:"VSA:"})," ",c.vsaNo]})]})},c.id))})]})},V=({customer:s,mode:a,onSuccess:t,onCancel:r})=>{const n=Ce(),i=ve(),[l,h]=j.useState({name:(s==null?void 0:s.name)||"",phone:(s==null?void 0:s.phone)||"",email:(s==null?void 0:s.email)||"",nric:(s==null?void 0:s.nric)||"",dob:(s==null?void 0:s.dob)||"",occupation:(s==null?void 0:s.occupation)||"",address:(s==null?void 0:s.address)||"",addressContinue:(s==null?void 0:s.addressContinue)||"",salesConsultant:(s==null?void 0:s.salesConsultant)||"",vsaNo:(s==null?void 0:s.vsaNo)||"",dealClosed:(s==null?void 0:s.dealClosed)||!1,notes:(s==null?void 0:s.notes)||""}),[o,u]=j.useState({}),[x,c]=j.useState(!1),[d,m]=j.useState((s==null?void 0:s.checklist)||{nricCollected:!1,testDriveCompleted:!1,vsaSigned:!1,tradeInDocuments:!1,paymentReceived:!1}),p=v=>{const{name:S,value:M,type:se}=v.target,te=v.target.checked;h(q=>({...q,[S]:se==="checkbox"?te:M})),o[S]&&u(q=>{const G={...q};return delete G[S],G})},_=(v,S)=>{m(M=>({...M,[v]:S}))},O=async v=>{v.preventDefault(),u({});try{a==="create"?await n.mutateAsync({...l,checklist:d}):s&&await i.mutateAsync({customerId:s.id,data:{...l,checklist:d}}),t()}catch(S){console.error("Failed to save customer:",S),u({submit:"Failed to save customer. Please try again."})}},g=n.isPending||i.isPending;return e.jsxs("form",{onSubmit:O,className:"customer-form",children:[e.jsxs("div",{className:"customer-form__section",children:[e.jsx("h3",{className:"customer-form__section-title",children:"Personal Information"}),e.jsxs("div",{className:"customer-form__grid",children:[e.jsx(y,{label:"Full Name",name:"name",value:l.name,onChange:p,error:o.name,required:!0,fullWidth:!0,disabled:g}),e.jsx(y,{label:"Phone Number",name:"phone",type:"tel",value:l.phone,onChange:p,error:o.phone,required:!0,fullWidth:!0,disabled:g}),e.jsx(y,{label:"Email Address",name:"email",type:"email",value:l.email,onChange:p,error:o.email,fullWidth:!0,disabled:g}),e.jsx(y,{label:"NRIC",name:"nric",value:l.nric,onChange:p,error:o.nric,helperText:"Format: S1234567A",required:!0,fullWidth:!0,disabled:g}),e.jsx(y,{label:"Date of Birth",name:"dob",type:"date",value:l.dob,onChange:p,error:o.dob,required:!0,fullWidth:!0,disabled:g}),e.jsx(y,{label:"Occupation",name:"occupation",value:l.occupation,onChange:p,error:o.occupation,fullWidth:!0,disabled:g})]})]}),e.jsxs("div",{className:"customer-form__section",children:[e.jsx("h3",{className:"customer-form__section-title",children:"Address"}),e.jsxs("div",{className:"customer-form__grid",children:[e.jsx(y,{label:"Address Line 1",name:"address",value:l.address,onChange:p,error:o.address,required:!0,fullWidth:!0,disabled:g}),e.jsx(y,{label:"Address Line 2",name:"addressContinue",value:l.addressContinue,onChange:p,error:o.addressContinue,fullWidth:!0,disabled:g})]})]}),e.jsxs("div",{className:"customer-form__section",children:[e.jsx("h3",{className:"customer-form__section-title",children:"Sales Information"}),e.jsxs("div",{className:"customer-form__grid",children:[e.jsx(y,{label:"Sales Consultant",name:"salesConsultant",value:l.salesConsultant,onChange:p,error:o.salesConsultant,required:!0,fullWidth:!0,disabled:g}),e.jsx(y,{label:"VSA Number",name:"vsaNo",value:l.vsaNo,onChange:p,error:o.vsaNo,helperText:"Vehicle Sales Agreement number",fullWidth:!0,disabled:g}),e.jsx("div",{className:"customer-form__checkbox",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",name:"dealClosed",checked:l.dealClosed,onChange:p,disabled:g}),e.jsx("span",{children:"Deal Closed"})]})})]})]}),e.jsxs("div",{className:"customer-form__section",children:[e.jsxs("div",{className:"customer-form__section-header",children:[e.jsx("h3",{className:"customer-form__section-title",children:"Checklist"}),e.jsx(C,{type:"button",variant:"ghost",size:"small",onClick:()=>c(!x),children:x?"Hide":"Show"})]}),x&&e.jsxs("div",{className:"customer-form__checklist",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:d.nricCollected,onChange:v=>_("nricCollected",v.target.checked),disabled:g}),e.jsx("span",{children:"NRIC Collected"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:d.testDriveCompleted,onChange:v=>_("testDriveCompleted",v.target.checked),disabled:g}),e.jsx("span",{children:"Test Drive Completed"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:d.vsaSigned,onChange:v=>_("vsaSigned",v.target.checked),disabled:g}),e.jsx("span",{children:"VSA Signed"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:d.tradeInDocuments,onChange:v=>_("tradeInDocuments",v.target.checked),disabled:g}),e.jsx("span",{children:"Trade-In Documents Received"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:d.paymentReceived,onChange:v=>_("paymentReceived",v.target.checked),disabled:g}),e.jsx("span",{children:"Payment Received"})]})]})]}),e.jsx("div",{className:"customer-form__section",children:e.jsx(Z,{label:"Notes",name:"notes",value:l.notes,onChange:p,error:o.notes,rows:4,fullWidth:!0,disabled:g})}),o.submit&&e.jsx("div",{className:"customer-form__error",children:o.submit}),e.jsxs("div",{className:"customer-form__actions",children:[e.jsx(C,{type:"button",variant:"ghost",onClick:r,disabled:g,children:"Cancel"}),e.jsx(C,{type:"submit",variant:"primary",loading:g,children:a==="create"?"Create Customer":"Save Changes"})]})]})},Ie=({customerId:s,onEdit:a,onBack:t,onDeleted:r})=>{const{data:n,isLoading:i,error:l}=je(s),h=Ne(),o=ye(),[u,x]=j.useState(!1),c=async()=>{try{await h.mutateAsync(s),x(!1),r()}catch(m){console.error("Failed to delete customer:",m)}},d=async(m,p)=>{if(n)try{await o.mutateAsync({customerId:s,key:m,value:p})}catch(_){console.error("Failed to update checklist:",_)}};return i?e.jsx("div",{className:"customer-details__loading",children:e.jsx(ee,{size:"large",label:"Loading customer details..."})}):l||!n?e.jsxs("div",{className:"customer-details__error",children:[e.jsx("p",{children:"Error loading customer details. Please try again."}),e.jsx(C,{onClick:t,children:"Go Back"})]}):e.jsxs("div",{className:"customer-details",children:[e.jsxs("div",{className:"customer-details__header",children:[e.jsxs(C,{variant:"ghost",onClick:t,className:"customer-details__back",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),"Back"]}),e.jsxs("div",{className:"customer-details__actions",children:[e.jsx(C,{variant:"secondary",onClick:()=>a(n),children:"Edit Customer"}),e.jsx(C,{variant:"danger",onClick:()=>x(!0),children:"Delete"})]})]}),e.jsx("div",{className:"customer-details__content",children:e.jsxs(L,{children:[e.jsx(we,{children:e.jsxs("div",{className:"customer-details__title-section",children:[e.jsx("h1",{className:"customer-details__name",children:n.name}),e.jsx("span",{className:`customer-details__badge ${n.dealClosed?"customer-details__badge--closed":"customer-details__badge--open"}`,children:n.dealClosed?"Deal Closed":"Deal Open"})]})}),e.jsx(R,{children:e.jsxs("div",{className:"customer-details__grid",children:[e.jsxs("div",{className:"customer-details__section",children:[e.jsx("h3",{className:"customer-details__section-title",children:"Personal Information"}),e.jsxs("div",{className:"customer-details__fields",children:[e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Phone"}),e.jsx("span",{className:"customer-details__field-value",children:e.jsx("a",{href:`tel:${n.phone}`,children:n.phone})})]}),n.email&&e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Email"}),e.jsx("span",{className:"customer-details__field-value",children:e.jsx("a",{href:`mailto:${n.email}`,children:n.email})})]}),e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"NRIC"}),e.jsx("span",{className:"customer-details__field-value",children:n.nric})]}),e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Date of Birth"}),e.jsx("span",{className:"customer-details__field-value",children:new Date(n.dob).toLocaleDateString()})]}),n.occupation&&e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Occupation"}),e.jsx("span",{className:"customer-details__field-value",children:n.occupation})]})]})]}),e.jsxs("div",{className:"customer-details__section",children:[e.jsx("h3",{className:"customer-details__section-title",children:"Address"}),e.jsx("div",{className:"customer-details__fields",children:e.jsx("div",{className:"customer-details__field",children:e.jsxs("span",{className:"customer-details__field-value",children:[n.address,n.addressContinue&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),n.addressContinue]})]})})})]}),e.jsxs("div",{className:"customer-details__section",children:[e.jsx("h3",{className:"customer-details__section-title",children:"Sales Information"}),e.jsxs("div",{className:"customer-details__fields",children:[e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Sales Consultant"}),e.jsx("span",{className:"customer-details__field-value",children:n.salesConsultant})]}),n.vsaNo&&e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"VSA Number"}),e.jsx("span",{className:"customer-details__field-value",children:n.vsaNo})]})]})]}),e.jsxs("div",{className:"customer-details__section customer-details__section--full",children:[e.jsx("h3",{className:"customer-details__section-title",children:"Checklist"}),e.jsx("div",{className:"customer-details__checklist",children:Object.entries(n.checklist).map(([m,p])=>e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:_=>d(m,_.target.checked)}),e.jsx("span",{children:Ee(m)})]},m))})]}),n.notes&&e.jsxs("div",{className:"customer-details__section customer-details__section--full",children:[e.jsx("h3",{className:"customer-details__section-title",children:"Notes"}),e.jsx("div",{className:"customer-details__notes",children:n.notes})]}),n.driveFolderLink&&e.jsxs("div",{className:"customer-details__section customer-details__section--full",children:[e.jsx("h3",{className:"customer-details__section-title",children:"Google Drive"}),e.jsx("div",{className:"customer-details__fields",children:e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Folder"}),e.jsx("span",{className:"customer-details__field-value",children:e.jsx("a",{href:n.driveFolderLink,target:"_blank",rel:"noopener noreferrer",children:"Open in Google Drive"})})]})})]}),e.jsxs("div",{className:"customer-details__section customer-details__section--full",children:[e.jsx("h3",{className:"customer-details__section-title",children:"Record Information"}),e.jsxs("div",{className:"customer-details__fields",children:[e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Created"}),e.jsx("span",{className:"customer-details__field-value",children:new Date(n.createdAt).toLocaleString()})]}),e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Last Updated"}),e.jsx("span",{className:"customer-details__field-value",children:new Date(n.updatedAt).toLocaleString()})]})]})]})]})})]})}),e.jsx(be,{isOpen:u,onClose:()=>x(!1),title:"Delete Customer",size:"small",children:e.jsxs("div",{className:"customer-details__delete-modal",children:[e.jsxs("p",{children:["Are you sure you want to delete ",e.jsx("strong",{children:n.name}),"? This action cannot be undone."]}),e.jsxs("div",{className:"customer-details__delete-actions",children:[e.jsx(C,{variant:"ghost",onClick:()=>x(!1),children:"Cancel"}),e.jsx(C,{variant:"danger",onClick:c,loading:h.isPending,children:"Delete Customer"})]})]})})]})};function Ee(s){return{nricCollected:"NRIC Collected",testDriveCompleted:"Test Drive Completed",vsaSigned:"VSA Signed",tradeInDocuments:"Trade-In Documents Received",paymentReceived:"Payment Received"}[s]||s}function H(){const{isSignedIn:s,isInitialized:a,isLoading:t,signIn:r,signOut:n,consultant:i}=pe(),[l,h]=j.useState("list"),[o,u]=j.useState(null);if(j.useEffect(()=>{console.log("Dashboard mounted"),console.log("Auth state:",{isSignedIn:s,isInitialized:a,isLoading:t})},[s,a,t]),!a||t)return e.jsx("div",{className:"dashboard",children:e.jsxs("div",{className:"dashboard-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading BYD CRM..."})]})});if(!s)return e.jsx("div",{className:"dashboard",children:e.jsx("div",{className:"dashboard-signin",children:e.jsxs("div",{className:"signin-card",children:[e.jsx("h1",{children:"BYD CRM"}),e.jsx("p",{children:"Customer Relationship Management System"}),e.jsx("p",{className:"signin-subtitle",children:"Sign in with your Google account to access your customer data"}),e.jsxs("button",{className:"btn-signin",onClick:r,children:[e.jsxs("svg",{width:"18",height:"18",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",children:[e.jsx("path",{fill:"#EA4335",d:"M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"}),e.jsx("path",{fill:"#4285F4",d:"M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"}),e.jsx("path",{fill:"#FBBC05",d:"M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"}),e.jsx("path",{fill:"#34A853",d:"M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"})]}),"Sign in with Google"]})]})})});const x=O=>{u(O),h("details")},c=()=>{u(null),h("create")},d=O=>{u(O),h("edit")},m=()=>{u(null),h("list")},p=()=>{u(null),h("list")},_=()=>{u(null),h("list")};return e.jsxs("div",{className:"dashboard",children:[e.jsx("header",{className:"dashboard-header",children:e.jsxs("div",{className:"header-content",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{children:"BYD CRM"}),l!=="list"&&e.jsxs("span",{className:"header-breadcrumb",children:[l==="create"&&"/ New Customer",l==="edit"&&`/ Edit: ${o==null?void 0:o.name}`,l==="details"&&`/ ${o==null?void 0:o.name}`]})]}),e.jsxs("div",{className:"header-user",children:[e.jsx("img",{src:i==null?void 0:i.picture,alt:i==null?void 0:i.name,className:"user-avatar"}),e.jsx("span",{className:"user-name",children:i==null?void 0:i.name}),e.jsx(C,{variant:"ghost",size:"small",onClick:n,children:"Sign Out"})]})]})}),e.jsxs("main",{className:"dashboard-main",children:[l==="list"&&e.jsx(Se,{onSelectCustomer:x,onCreateCustomer:c}),l==="create"&&e.jsxs("div",{className:"dashboard-form-container",children:[e.jsx("h2",{className:"dashboard-form-title",children:"Create New Customer"}),e.jsx(V,{mode:"create",onSuccess:p,onCancel:_})]}),l==="edit"&&o&&e.jsxs("div",{className:"dashboard-form-container",children:[e.jsx("h2",{className:"dashboard-form-title",children:"Edit Customer"}),e.jsx(V,{customer:o,mode:"edit",onSuccess:p,onCancel:_})]}),l==="details"&&o&&e.jsx(Ie,{customerId:o.id,onEdit:d,onBack:m,onDeleted:m})]})]})}const Ae=new ie({defaultOptions:{queries:{staleTime:5*60*1e3,retry:3}}});function ke(){return j.useEffect(()=>{const{valid:s,errors:a}=he();s?console.log("âœ… Configuration valid"):(console.error("âŒ Configuration errors:",a),a.forEach(t=>console.error(`  - ${t}`))),console.log(`ğŸš€ ${A.APP.NAME} v${A.APP.VERSION}`),console.log(`ğŸŒ Environment: ${A.APP.ENV}`)},[]),e.jsx(le,{client:Ae,children:e.jsx(oe,{children:e.jsxs(ce,{children:[e.jsx(Q,{path:"/",element:e.jsx(H,{})}),e.jsx(Q,{path:"*",element:e.jsx(H,{})})]})})})}z.createRoot(document.getElementById("root")).render(e.jsx(de.StrictMode,{children:e.jsx(ke,{})}));
//# sourceMappingURL=index-BMOoTLEO.js.map
