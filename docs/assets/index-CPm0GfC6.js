var se=Object.defineProperty;var te=(s,t,a)=>t in s?se(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var w=(s,t,a)=>te(s,typeof t!="symbol"?t+"":t,a);import{c as ae,u as K,a as R,b as O,j as e,Q as ne,d as ie}from"./vendor-state-HHgQU-Dp.js";import{a as W,r as _,B as re,b as le,d as $,R as oe}from"./vendor-react-D_6SLu_M.js";import{D as ce}from"./vendor-db-Z29b7Thg.js";import{o as H,b as M,s as f,r as G,l as A,n as Y}from"./vendor-utils-BN0HniSu.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function a(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=a(n);fetch(n.href,r)}})();var z={},Q=W;z.createRoot=Q.createRoot,z.hydrateRoot=Q.hydrateRoot;const T={GOOGLE:{CLIENT_ID:"",API_KEY:"",SCOPES:["https://www.googleapis.com/auth/drive","https://www.googleapis.com/auth/drive.appdata"].join(" "),DISCOVERY_DOCS:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]},DRIVE_FOLDERS:{ROOT:"BYD CRM",CUSTOMERS_DATA:"BYD Customers Data",FORMS:"BYD CRM - Form Templates",EXCEL:"BYD CRM - Excel Templates",CUSTOMER_SUBFOLDERS:["NRIC","Test Drive","VSA","Trade In","Other Documents"]},SYNC:{BATCH_SIZE:10,RETRY_LIMIT:3,RETRY_DELAY:1e3,AUTO_SYNC_INTERVAL:5*60*1e3,TIMEOUT:3e4},ENCRYPTION:{SALT:"default-salt-change-me",ALGORITHM:"AES"},UI:{ITEMS_PER_PAGE:20,DEBOUNCE_DELAY:300,TOAST_DURATION:3e3,MAX_FILE_SIZE:10*1024*1024},APP:{NAME:"BYD CRM",VERSION:"2.0.0",ENV:"development"},FEATURES:{OFFLINE_MODE:!0,AUTO_SYNC:!0,DATA_ENCRYPTION:!0,DEBUG_MODE:!1}};function de(){const s=[];return s.push("Missing VITE_GOOGLE_CLIENT_ID environment variable"),s.push("Missing VITE_GOOGLE_API_KEY environment variable"),{valid:s.length===0,errors:s}}const E=class E{constructor(){w(this,"tokenClient",null);w(this,"accessToken",null);w(this,"isInitialized",!1);w(this,"currentConsultant",null)}static getInstance(){return E.instance||(E.instance=new E),E.instance}async init(){if(!this.isInitialized)return new Promise((t,a)=>{var n;if((n=window.google)!=null&&n.accounts){this.initializeGIS(t,a);return}const i=document.createElement("script");i.src="https://accounts.google.com/gsi/client",i.async=!0,i.defer=!0,i.onload=()=>{this.initializeGIS(t,a)},i.onerror=()=>{a(new Error("Failed to load Google Identity Services script"))},document.body.appendChild(i)})}initializeGIS(t,a){try{this.tokenClient=google.accounts.oauth2.initTokenClient({client_id:T.GOOGLE.CLIENT_ID,scope:T.GOOGLE.SCOPES});const i=sessionStorage.getItem("consultant"),n=sessionStorage.getItem("access_token");i&&n&&(this.currentConsultant=JSON.parse(i),this.accessToken=n),this.isInitialized=!0,console.log("âœ… Google Identity Services initialized"),t()}catch(i){console.error("âŒ Failed to initialize Google Identity Services:",i),a(i instanceof Error?i:new Error("Failed to initialize Google Identity Services"))}}async signIn(){if(!this.tokenClient)throw new Error("Google Identity Services not initialized. Call init() first.");return new Promise((t,a)=>{if(!this.tokenClient){a(new Error("Token client not initialized"));return}try{const i=this.tokenClient;i.callback=async n=>{if(n.error){console.error("âŒ OAuth error:",n.error),a(new Error(n.error));return}this.accessToken=n.access_token,sessionStorage.setItem("access_token",n.access_token);try{const r=await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${n.access_token}`}});if(!r.ok)throw new Error("Failed to fetch user info");const l=await r.json(),u={id:l.id,email:l.email,name:l.name,picture:l.picture};this.currentConsultant=u,sessionStorage.setItem("consultant",JSON.stringify(u)),console.log("âœ… Signed in as:",u.email),t(u)}catch(r){console.error("âŒ Failed to fetch user info:",r),a(new Error("Failed to fetch user info"))}},i.requestAccessToken({prompt:"consent"})}catch(i){console.error("âŒ Sign in failed:",i),a(i instanceof Error?i:new Error("Failed to sign in with Google"))}})}async signOut(){try{this.accessToken&&await fetch(`https://oauth2.googleapis.com/revoke?token=${this.accessToken}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}),this.accessToken=null,this.currentConsultant=null,sessionStorage.removeItem("consultant"),sessionStorage.removeItem("access_token"),console.log("âœ… Signed out")}catch(t){console.error("âŒ Sign out failed:",t),this.accessToken=null,this.currentConsultant=null,sessionStorage.removeItem("consultant"),sessionStorage.removeItem("access_token")}}isSignedIn(){return this.currentConsultant!==null&&this.accessToken!==null}getCurrentConsultant(){if(this.currentConsultant)return this.currentConsultant;const t=sessionStorage.getItem("consultant");if(!t)return null;try{return this.currentConsultant=JSON.parse(t),this.currentConsultant}catch{return null}}getAccessToken(){if(this.accessToken)return this.accessToken;const t=sessionStorage.getItem("access_token");return t?(this.accessToken=t,t):""}onAuthStateChange(t){return t(this.isSignedIn()),()=>{console.log("Auth state listener cleaned up")}}getIsInitialized(){return this.isInitialized}};w(E,"instance");let q=E;const v=q.getInstance();class ue extends ce{constructor(){super("BYD_CRM_DB");w(this,"customers");w(this,"formTemplates");w(this,"excelTemplates");w(this,"syncQueue");this.version(1).stores({customers:"id, consultantId, name, createdAt, updatedAt, dealClosed",formTemplates:"id, consultantId, name, createdAt",excelTemplates:"id, consultantId, name, createdAt",syncQueue:"id, consultantId, status, entityType, createdAt"})}async clearConsultantData(a){await this.transaction("rw",[this.customers,this.formTemplates,this.excelTemplates,this.syncQueue],async()=>{await this.customers.where("consultantId").equals(a).delete(),await this.formTemplates.where("consultantId").equals(a).delete(),await this.excelTemplates.where("consultantId").equals(a).delete(),await this.syncQueue.where("consultantId").equals(a).delete()})}async getStats(a){return{customers:await this.customers.where("consultantId").equals(a).count(),forms:await this.formTemplates.where("consultantId").equals(a).count(),excel:await this.excelTemplates.where("consultantId").equals(a).count(),pendingSync:await this.syncQueue.where({consultantId:a,status:"pending"}).count()}}}const k=new ue,me=ae((s,t)=>({consultant:null,isInitialized:!1,isSignedIn:!1,isLoading:!1,error:null,init:async()=>{try{s({isLoading:!0,error:null}),await v.init();const a=v.isSignedIn(),i=a?v.getCurrentConsultant():null;s({isInitialized:!0,isSignedIn:a,consultant:i,isLoading:!1}),console.log("âœ… Auth initialized, signed in:",a)}catch(a){const i=a instanceof Error?a.message:"Failed to initialize auth";s({isInitialized:!0,isLoading:!1,error:i}),console.error("âŒ Auth initialization failed:",i)}},signIn:async()=>{try{s({isLoading:!0,error:null});const a=await v.signIn();s({consultant:a,isSignedIn:!0,isLoading:!1}),console.log("âœ… Signed in successfully")}catch(a){const i=a instanceof Error?a.message:"Failed to sign in";throw s({isLoading:!1,error:i}),console.error("âŒ Sign in failed:",i),a}},signOut:async()=>{try{s({isLoading:!0,error:null});const a=t().consultant;await v.signOut(),a&&(await k.clearConsultantData(a.id),console.log("âœ… Cleared local data for consultant:",a.id)),s({consultant:null,isSignedIn:!1,isLoading:!1}),console.log("âœ… Signed out successfully")}catch(a){const i=a instanceof Error?a.message:"Failed to sign out";throw s({isLoading:!1,error:i}),console.error("âŒ Sign out failed:",i),a}},clearError:()=>s({error:null})}));function he(){const s=me();return _.useEffect(()=>{s.isInitialized||s.init()},[s.isInitialized,s.init]),{consultant:s.consultant,isSignedIn:s.isSignedIn,isInitialized:s.isInitialized,isLoading:s.isLoading,error:s.error,signIn:s.signIn,signOut:s.signOut,clearError:s.clearError,isReady:s.isInitialized&&!s.isLoading}}const L=H({id:f().uuid(),consultantId:f().min(1,"Consultant ID required"),name:f().min(2,"Name must be at least 2 characters").max(100,"Name must be less than 100 characters").trim(),phone:f().regex(/^\+?[0-9\s-()]+$/,"Invalid phone number format").min(8,"Phone number too short").max(20,"Phone number too long").trim(),email:f().email("Invalid email address").optional().or(A("")).transform(s=>s===""?void 0:s),nric:f().regex(/^[STFG]\d{7}[A-Z]$/,"Invalid NRIC format (e.g., S1234567A)").toUpperCase().trim(),dob:f().regex(/^\d{4}-\d{2}-\d{2}$/,"Date must be in YYYY-MM-DD format"),occupation:f().max(100,"Occupation too long").optional().or(A("")).transform(s=>s===""?void 0:s),address:f().min(5,"Address must be at least 5 characters").max(200,"Address too long").trim(),addressContinue:f().max(200,"Address continuation too long").optional().or(A("")).transform(s=>s===""?void 0:s),salesConsultant:f().min(2,"Sales consultant name required").trim(),vsaNo:f().optional().or(A("")).transform(s=>s===""?void 0:s),dealClosed:M().default(!1),driveFolderId:f().optional(),driveFolderLink:f().url().optional().or(A("")).transform(s=>s===""?void 0:s),subfolders:G(f()).optional(),notes:f().max(2e3,"Notes too long").optional().or(A("")).transform(s=>s===""?void 0:s),checklist:G(M()).default({}),createdAt:f().datetime(),updatedAt:f().datetime(),encrypted:M().default(!1)});L.omit({id:!0,consultantId:!0,createdAt:!0,updatedAt:!0,encrypted:!0,driveFolderId:!0,driveFolderLink:!0,subfolders:!0});L.omit({id:!0,consultantId:!0,createdAt:!0,updatedAt:!0,encrypted:!0}).partial();H({query:f().min(1,"Search query required"),limit:Y().min(1).max(100).default(20),offset:Y().min(0).default(0)});class pe{async getAll(){const t=v.getCurrentConsultant();if(!t)throw new Error("Not authenticated");return k.customers.where("consultantId").equals(t.id).reverse().sortBy("createdAt")}async getById(t){const a=v.getCurrentConsultant();if(!a)throw new Error("Not authenticated");const i=await k.customers.get(t);if(i&&i.consultantId!==a.id)throw new Error("Unauthorized: Cannot access another consultant's customer");return i||null}async create(t){const a=v.getCurrentConsultant();if(!a)throw new Error("Not authenticated");const i=crypto.randomUUID(),n={...t,id:i,consultantId:a.id,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),encrypted:!1,checklist:t.checklist||{},dealClosed:t.dealClosed||!1},r=L.parse(n);return await k.customers.add(r),console.log("âœ… Customer created:",r.id),r}async update(t,a){const i=v.getCurrentConsultant();if(!i)throw new Error("Not authenticated");const n=await this.getById(t);if(!n)throw new Error("Customer not found");const r={...n,...a,id:t,consultantId:i.id,updatedAt:new Date().toISOString()},l=L.parse(r);return await k.customers.put(l),console.log("âœ… Customer updated:",l.id),l}async delete(t){if(!v.getCurrentConsultant())throw new Error("Not authenticated");if(!await this.getById(t))throw new Error("Customer not found");await k.customers.delete(t),console.log("âœ… Customer deleted:",t)}async search(t){if(!v.getCurrentConsultant())throw new Error("Not authenticated");const i=await this.getAll(),n=t.toLowerCase().trim();return n?i.filter(r=>{var l,u;return r.name.toLowerCase().includes(n)||r.phone.includes(t)||((l=r.email)==null?void 0:l.toLowerCase().includes(n))||r.nric.toLowerCase().includes(n)||((u=r.vsaNo)==null?void 0:u.toLowerCase().includes(n))}):i}async getByDealStatus(t){const a=v.getCurrentConsultant();if(!a)throw new Error("Not authenticated");return k.customers.where({consultantId:a.id,dealClosed:t}).reverse().sortBy("updatedAt")}async toggleDealClosed(t){const a=await this.getById(t);if(!a)throw new Error("Customer not found");return this.update(t,{dealClosed:!a.dealClosed})}async updateChecklistItem(t,a,i){const n=await this.getById(t);if(!n)throw new Error("Customer not found");const r={...n.checklist,[a]:i};return this.update(t,{checklist:r})}async getStats(){if(!v.getCurrentConsultant())throw new Error("Not authenticated");const a=await this.getAll();return{total:a.length,open:a.filter(i=>!i.dealClosed).length,closed:a.filter(i=>i.dealClosed).length}}}const D=new pe,y={customers:["customers"],customer:s=>["customers",s],stats:["customers","stats"],search:s=>["customers","search",s]},xe=()=>K({queryKey:y.customers,queryFn:()=>D.getAll()}),fe=s=>K({queryKey:y.customer(s),queryFn:()=>D.getById(s),enabled:!!s}),ge=()=>{const s=R();return O({mutationFn:t=>D.create(t),onSuccess:()=>{s.invalidateQueries({queryKey:y.customers}),s.invalidateQueries({queryKey:y.stats})}})},_e=()=>{const s=R();return O({mutationFn:({customerId:t,data:a})=>D.update(t,a),onSuccess:(t,a)=>{s.invalidateQueries({queryKey:y.customers}),s.invalidateQueries({queryKey:y.customer(a.customerId)}),s.invalidateQueries({queryKey:y.stats})}})},je=()=>{const s=R();return O({mutationFn:t=>D.delete(t),onSuccess:()=>{s.invalidateQueries({queryKey:y.customers}),s.invalidateQueries({queryKey:y.stats})}})},Ce=()=>{const s=R();return O({mutationFn:({customerId:t,key:a,value:i})=>D.updateChecklistItem(t,a,i),onSuccess:(t,a)=>{s.invalidateQueries({queryKey:y.customers}),s.invalidateQueries({queryKey:y.customer(a.customerId)})}})},C=({variant:s="primary",size:t="medium",loading:a=!1,fullWidth:i=!1,disabled:n,children:r,className:l="",...u})=>{const c=["btn",`btn--${s}`,`btn--${t}`,i&&"btn--full-width",a&&"btn--loading",l].filter(Boolean).join(" ");return e.jsxs("button",{className:c,disabled:n||a,...u,children:[a&&e.jsx("span",{className:"btn__spinner","aria-hidden":"true",children:e.jsx("svg",{className:"btn__spinner-svg",viewBox:"0 0 24 24",children:e.jsx("circle",{className:"btn__spinner-circle",cx:"12",cy:"12",r:"10",fill:"none",strokeWidth:"3"})})}),e.jsx("span",{className:a?"btn__text--hidden":"btn__text",children:r})]})},b=_.forwardRef(({label:s,error:t,helperText:a,fullWidth:i=!1,leftIcon:n,rightIcon:r,className:l="",id:u,required:c,disabled:o,...m},h)=>{const d=u||`input-${Math.random().toString(36).substr(2,9)}`,N=!!t,x=["input-wrapper",i&&"input-wrapper--full-width",o&&"input-wrapper--disabled"].filter(Boolean).join(" "),g=["input",N&&"input--error",n&&"input--has-left-icon",r&&"input--has-right-icon",l].filter(Boolean).join(" ");return e.jsxs("div",{className:x,children:[s&&e.jsxs("label",{htmlFor:d,className:"input-label",children:[s,c&&e.jsx("span",{className:"input-label__required",children:"*"})]}),e.jsxs("div",{className:"input-container",children:[n&&e.jsx("span",{className:"input-icon input-icon--left",children:n}),e.jsx("input",{ref:h,id:d,className:g,disabled:o,"aria-invalid":N,"aria-describedby":t?`${d}-error`:a?`${d}-helper`:void 0,...m}),r&&e.jsx("span",{className:"input-icon input-icon--right",children:r})]}),t&&e.jsx("p",{id:`${d}-error`,className:"input-message input-message--error",children:t}),!t&&a&&e.jsx("p",{id:`${d}-helper`,className:"input-message input-message--helper",children:a})]})});b.displayName="Input";const J=_.forwardRef(({label:s,error:t,helperText:a,fullWidth:i=!1,className:n="",id:r,required:l,disabled:u,...c},o)=>{const m=r||`textarea-${Math.random().toString(36).substr(2,9)}`,h=!!t,d=["input-wrapper",i&&"input-wrapper--full-width",u&&"input-wrapper--disabled"].filter(Boolean).join(" "),N=["input",h&&"input--error",n].filter(Boolean).join(" ");return e.jsxs("div",{className:d,children:[s&&e.jsxs("label",{htmlFor:m,className:"input-label",children:[s,l&&e.jsx("span",{className:"input-label__required",children:"*"})]}),e.jsx("textarea",{ref:o,id:m,className:N,disabled:u,"aria-invalid":h,"aria-describedby":t?`${m}-error`:a?`${m}-helper`:void 0,...c}),t&&e.jsx("p",{id:`${m}-error`,className:"input-message input-message--error",children:t}),!t&&a&&e.jsx("p",{id:`${m}-helper`,className:"input-message input-message--helper",children:a})]})});J.displayName="Textarea";const ve=({isOpen:s,onClose:t,title:a,children:i,size:n="medium",showCloseButton:r=!0,closeOnOverlayClick:l=!0,closeOnEscape:u=!0})=>{const c=_.useRef(null);if(_.useEffect(()=>{const h=d=>{u&&d.key==="Escape"&&s&&t()};return s&&(document.addEventListener("keydown",h),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",h),document.body.style.overflow=""}},[s,t,u]),_.useEffect(()=>{if(s&&c.current){const d=c.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')[0];d==null||d.focus()}},[s]),!s)return null;const o=h=>{l&&h.target===h.currentTarget&&t()},m=e.jsx("div",{className:"modal-overlay",onClick:o,role:"dialog","aria-modal":"true",children:e.jsxs("div",{ref:c,className:`modal modal--${n}`,children:[(a||r)&&e.jsxs("div",{className:"modal__header",children:[a&&e.jsx("h2",{className:"modal__title",children:a}),r&&e.jsx("button",{type:"button",className:"modal__close",onClick:t,"aria-label":"Close modal",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsx("div",{className:"modal__content",children:i})]})});return W.createPortal(m,document.body)},Z=({size:s="medium",color:t="primary",fullScreen:a=!1,label:i="Loading..."})=>{const n=e.jsxs("div",{className:`spinner spinner--${s} spinner--${t}`,role:"status",children:[e.jsx("svg",{className:"spinner__svg",viewBox:"0 0 50 50",children:e.jsx("circle",{className:"spinner__circle",cx:"25",cy:"25",r:"20",fill:"none",strokeWidth:"4"})}),e.jsx("span",{className:"spinner__label",children:i})]});return a?e.jsx("div",{className:"spinner-container spinner-container--fullscreen",children:n}):n},Ne=s=>s.split(" ").map(t=>t[0]).join("").substring(0,2).toUpperCase(),be=s=>{const t=["#00BCD4","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F3","#00BCD4","#009688"],a=s.charCodeAt(0)%t.length;return t[a]},ye=({onSelectCustomer:s,onCreateCustomer:t,selectedCustomerId:a})=>{const[i,n]=_.useState(""),{data:r=[],isLoading:l,error:u}=xe(),c=_.useMemo(()=>{let o=[...r];if(i.trim()){const m=i.toLowerCase();o=o.filter(h=>{var d;return h.name.toLowerCase().includes(m)||h.phone.includes(m)||((d=h.email)==null?void 0:d.toLowerCase().includes(m))||h.nric.toLowerCase().includes(m)})}return o.sort((m,h)=>new Date(h.createdAt).getTime()-new Date(m.createdAt).getTime()),o},[r,i]);return l?e.jsx("div",{className:"customer-list",children:e.jsx("div",{className:"customer-list__loading",children:e.jsx(Z,{size:"medium"})})}):u?e.jsx("div",{className:"customer-list",children:e.jsxs("div",{className:"customer-list__empty",children:[e.jsx("p",{children:"Error loading customers"}),e.jsx(C,{size:"small",onClick:()=>window.location.reload(),children:"Reload"})]})}):e.jsxs("div",{className:"customer-list",children:[e.jsxs("div",{className:"customer-list__header",children:[e.jsx("h2",{className:"customer-list__title",children:"Customer List"}),e.jsx(C,{variant:"primary",size:"small",onClick:t,children:"+ Add Customer"})]}),e.jsx("div",{className:"customer-list__search",children:e.jsx("input",{type:"text",className:"customer-list__search-input",placeholder:"Search customers...",value:i,onChange:o=>n(o.target.value)})}),e.jsx("div",{className:"customer-list__items",children:c.length===0?e.jsx("div",{className:"customer-list__empty",children:i?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"customer-list__empty-text",children:"No customers found"}),e.jsx(C,{size:"small",variant:"ghost",onClick:()=>n(""),children:"Clear Search"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"customer-list__empty-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsx("p",{className:"customer-list__empty-text",children:"No customers yet"}),e.jsx(C,{size:"small",variant:"primary",onClick:t,children:"Create First Customer"})]})}):c.map(o=>e.jsxs("div",{className:`customer-list__item ${a===o.id?"customer-list__item--active":""}`,onClick:()=>s(o),children:[e.jsx("div",{className:"customer-list__item-avatar avatar",style:{backgroundColor:be(o.name)},children:Ne(o.name)}),e.jsxs("div",{className:"customer-list__item-info",children:[e.jsx("div",{className:"customer-list__item-name",children:o.name}),e.jsx("div",{className:"customer-list__item-phone",children:o.phone})]})]},o.id))})]})},U=({customer:s,mode:t,onSuccess:a,onCancel:i})=>{const n=ge(),r=_e(),[l,u]=_.useState({name:(s==null?void 0:s.name)||"",phone:(s==null?void 0:s.phone)||"",email:(s==null?void 0:s.email)||"",nric:(s==null?void 0:s.nric)||"",dob:(s==null?void 0:s.dob)||"",occupation:(s==null?void 0:s.occupation)||"",address:(s==null?void 0:s.address)||"",addressContinue:(s==null?void 0:s.addressContinue)||"",salesConsultant:(s==null?void 0:s.salesConsultant)||"",vsaNo:(s==null?void 0:s.vsaNo)||"",dealClosed:(s==null?void 0:s.dealClosed)||!1,notes:(s==null?void 0:s.notes)||""}),[c,o]=_.useState({}),[m,h]=_.useState(!1),[d,N]=_.useState((s==null?void 0:s.checklist)||{nricCollected:!1,testDriveCompleted:!1,vsaSigned:!1,tradeInDocuments:!1,paymentReceived:!1}),x=j=>{const{name:I,value:F,type:X}=j.target,ee=j.target.checked;u(B=>({...B,[I]:X==="checkbox"?ee:F})),c[I]&&o(B=>{const P={...B};return delete P[I],P})},g=(j,I)=>{N(F=>({...F,[j]:I}))},S=async j=>{j.preventDefault(),o({});try{t==="create"?await n.mutateAsync({...l,checklist:d}):s&&await r.mutateAsync({customerId:s.id,data:{...l,checklist:d}}),a()}catch(I){console.error("Failed to save customer:",I),o({submit:"Failed to save customer. Please try again."})}},p=n.isPending||r.isPending;return e.jsxs("form",{onSubmit:S,className:"customer-form",children:[e.jsxs("div",{className:"customer-form__section",children:[e.jsx("h3",{className:"customer-form__section-title",children:"Personal Information"}),e.jsxs("div",{className:"customer-form__grid",children:[e.jsx(b,{label:"Full Name",name:"name",value:l.name,onChange:x,error:c.name,required:!0,fullWidth:!0,disabled:p}),e.jsx(b,{label:"Phone Number",name:"phone",type:"tel",value:l.phone,onChange:x,error:c.phone,required:!0,fullWidth:!0,disabled:p}),e.jsx(b,{label:"Email Address",name:"email",type:"email",value:l.email,onChange:x,error:c.email,fullWidth:!0,disabled:p}),e.jsx(b,{label:"NRIC",name:"nric",value:l.nric,onChange:x,error:c.nric,helperText:"Format: S1234567A",required:!0,fullWidth:!0,disabled:p}),e.jsx(b,{label:"Date of Birth",name:"dob",type:"date",value:l.dob,onChange:x,error:c.dob,required:!0,fullWidth:!0,disabled:p}),e.jsx(b,{label:"Occupation",name:"occupation",value:l.occupation,onChange:x,error:c.occupation,fullWidth:!0,disabled:p})]})]}),e.jsxs("div",{className:"customer-form__section",children:[e.jsx("h3",{className:"customer-form__section-title",children:"Address"}),e.jsxs("div",{className:"customer-form__grid",children:[e.jsx(b,{label:"Address Line 1",name:"address",value:l.address,onChange:x,error:c.address,required:!0,fullWidth:!0,disabled:p}),e.jsx(b,{label:"Address Line 2",name:"addressContinue",value:l.addressContinue,onChange:x,error:c.addressContinue,fullWidth:!0,disabled:p})]})]}),e.jsxs("div",{className:"customer-form__section",children:[e.jsx("h3",{className:"customer-form__section-title",children:"Sales Information"}),e.jsxs("div",{className:"customer-form__grid",children:[e.jsx(b,{label:"Sales Consultant",name:"salesConsultant",value:l.salesConsultant,onChange:x,error:c.salesConsultant,required:!0,fullWidth:!0,disabled:p}),e.jsx(b,{label:"VSA Number",name:"vsaNo",value:l.vsaNo,onChange:x,error:c.vsaNo,helperText:"Vehicle Sales Agreement number",fullWidth:!0,disabled:p}),e.jsx("div",{className:"customer-form__checkbox",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",name:"dealClosed",checked:l.dealClosed,onChange:x,disabled:p}),e.jsx("span",{children:"Deal Closed"})]})})]})]}),e.jsxs("div",{className:"customer-form__section",children:[e.jsxs("div",{className:"customer-form__section-header",children:[e.jsx("h3",{className:"customer-form__section-title",children:"Checklist"}),e.jsx(C,{type:"button",variant:"ghost",size:"small",onClick:()=>h(!m),children:m?"Hide":"Show"})]}),m&&e.jsxs("div",{className:"customer-form__checklist",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:d.nricCollected,onChange:j=>g("nricCollected",j.target.checked),disabled:p}),e.jsx("span",{children:"NRIC Collected"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:d.testDriveCompleted,onChange:j=>g("testDriveCompleted",j.target.checked),disabled:p}),e.jsx("span",{children:"Test Drive Completed"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:d.vsaSigned,onChange:j=>g("vsaSigned",j.target.checked),disabled:p}),e.jsx("span",{children:"VSA Signed"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:d.tradeInDocuments,onChange:j=>g("tradeInDocuments",j.target.checked),disabled:p}),e.jsx("span",{children:"Trade-In Documents Received"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:d.paymentReceived,onChange:j=>g("paymentReceived",j.target.checked),disabled:p}),e.jsx("span",{children:"Payment Received"})]})]})]}),e.jsx("div",{className:"customer-form__section",children:e.jsx(J,{label:"Notes",name:"notes",value:l.notes,onChange:x,error:c.notes,rows:4,fullWidth:!0,disabled:p})}),c.submit&&e.jsx("div",{className:"customer-form__error",children:c.submit}),e.jsxs("div",{className:"customer-form__actions",children:[e.jsx(C,{type:"button",variant:"ghost",onClick:i,disabled:p,children:"Cancel"}),e.jsx(C,{type:"submit",variant:"primary",loading:p,children:t==="create"?"Create Customer":"Save Changes"})]})]})},we=({customerId:s,onEdit:t,onBack:a,onDeleted:i})=>{const{data:n,isLoading:r,error:l}=fe(s),u=je(),c=Ce(),[o,m]=_.useState("details"),[h,d]=_.useState(!1),N=async()=>{try{await u.mutateAsync(s),d(!1),i()}catch(g){console.error("Failed to delete customer:",g)}},x=async(g,S)=>{if(n)try{await c.mutateAsync({customerId:s,key:g,value:S})}catch(p){console.error("Failed to update checklist:",p)}};return r?e.jsx("div",{className:"customer-details__loading",children:e.jsx(Z,{size:"large",label:"Loading customer details..."})}):l||!n?e.jsxs("div",{className:"customer-details__error",children:[e.jsx("p",{children:"Error loading customer details. Please try again."}),e.jsx(C,{onClick:a,children:"Go Back"})]}):e.jsxs("div",{className:"customer-details",children:[e.jsxs("div",{className:"customer-details__header",children:[e.jsx("h1",{className:"customer-details__name",children:n.name}),e.jsxs("div",{className:"customer-details__actions",children:[e.jsx(C,{variant:"primary",size:"medium",children:"Print Form"}),e.jsx(C,{variant:"primary",size:"medium",children:"Combine & Print"}),e.jsx(C,{variant:"primary",size:"medium",children:"Populate Excel"})]})]}),e.jsxs("div",{className:"customer-details__tabs tabs",children:[e.jsx("button",{className:`tab ${o==="details"?"tab-active":""}`,onClick:()=>m("details"),children:"Details"}),e.jsx("button",{className:`tab ${o==="proposal"?"tab-active":""}`,onClick:()=>m("proposal"),children:"Proposal"}),e.jsx("button",{className:`tab ${o==="vsa"?"tab-active":""}`,onClick:()=>m("vsa"),children:"VSA"}),e.jsx("button",{className:`tab ${o==="documents"?"tab-active":""}`,onClick:()=>m("documents"),children:"Documents"}),e.jsx("button",{className:`tab ${o==="scanner"?"tab-active":""}`,onClick:()=>m("scanner"),children:"Scanner"})]}),e.jsxs("div",{className:"customer-details__content",children:[o==="details"&&e.jsxs("div",{className:"customer-details__tab-panel",children:[e.jsx("div",{className:"customer-details__info-header",children:e.jsx(C,{variant:"primary",size:"medium",onClick:()=>t(n),children:"Edit Details"})}),e.jsxs("div",{className:"customer-details__grid",children:[e.jsxs("div",{className:"customer-details__section",children:[e.jsx("h3",{className:"customer-details__section-title",children:"Personal Information"}),e.jsxs("div",{className:"customer-details__fields",children:[e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Phone"}),e.jsx("span",{className:"customer-details__field-value",children:e.jsx("a",{href:`tel:${n.phone}`,children:n.phone})})]}),n.email&&e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Email"}),e.jsx("span",{className:"customer-details__field-value",children:e.jsx("a",{href:`mailto:${n.email}`,children:n.email})})]}),e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"NRIC"}),e.jsx("span",{className:"customer-details__field-value",children:n.nric})]}),e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Date of Birth"}),e.jsx("span",{className:"customer-details__field-value",children:new Date(n.dob).toLocaleDateString()})]}),n.occupation&&e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Occupation"}),e.jsx("span",{className:"customer-details__field-value",children:n.occupation})]})]})]}),e.jsxs("div",{className:"customer-details__section",children:[e.jsx("h3",{className:"customer-details__section-title",children:"Address"}),e.jsx("div",{className:"customer-details__fields",children:e.jsx("div",{className:"customer-details__field",children:e.jsxs("span",{className:"customer-details__field-value",children:[n.address,n.addressContinue&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),n.addressContinue]})]})})})]}),e.jsxs("div",{className:"customer-details__section",children:[e.jsx("h3",{className:"customer-details__section-title",children:"Sales Information"}),e.jsxs("div",{className:"customer-details__fields",children:[e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Sales Consultant"}),e.jsx("span",{className:"customer-details__field-value",children:n.salesConsultant})]}),n.vsaNo&&e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"VSA Number"}),e.jsx("span",{className:"customer-details__field-value",children:n.vsaNo})]})]})]}),e.jsxs("div",{className:"customer-details__section customer-details__section--full",children:[e.jsx("h3",{className:"customer-details__section-title",children:"Checklist"}),e.jsx("div",{className:"customer-details__checklist",children:Object.entries(n.checklist).map(([g,S])=>e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:p=>x(g,p.target.checked)}),e.jsx("span",{children:Se(g)})]},g))})]}),n.notes&&e.jsxs("div",{className:"customer-details__section customer-details__section--full",children:[e.jsx("h3",{className:"customer-details__section-title",children:"Notes"}),e.jsx("div",{className:"customer-details__notes",children:n.notes})]}),n.driveFolderLink&&e.jsxs("div",{className:"customer-details__section customer-details__section--full",children:[e.jsx("h3",{className:"customer-details__section-title",children:"Google Drive"}),e.jsx("div",{className:"customer-details__fields",children:e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Folder"}),e.jsx("span",{className:"customer-details__field-value",children:e.jsx("a",{href:n.driveFolderLink,target:"_blank",rel:"noopener noreferrer",children:"Open in Google Drive"})})]})})]}),e.jsxs("div",{className:"customer-details__section customer-details__section--full",children:[e.jsx("h3",{className:"customer-details__section-title",children:"Record Information"}),e.jsxs("div",{className:"customer-details__fields",children:[e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Created"}),e.jsx("span",{className:"customer-details__field-value",children:new Date(n.createdAt).toLocaleString()})]}),e.jsxs("div",{className:"customer-details__field",children:[e.jsx("span",{className:"customer-details__field-label",children:"Last Updated"}),e.jsx("span",{className:"customer-details__field-value",children:new Date(n.updatedAt).toLocaleString()})]})]})]})]}),e.jsx("div",{className:"customer-details__danger-zone",children:e.jsx(C,{variant:"danger",size:"medium",onClick:()=>d(!0),children:"Delete Customer"})})]}),o==="proposal"&&e.jsx("div",{className:"customer-details__tab-panel",children:e.jsx("p",{className:"customer-details__placeholder",children:"Proposal feature coming soon..."})}),o==="vsa"&&e.jsx("div",{className:"customer-details__tab-panel",children:e.jsx("p",{className:"customer-details__placeholder",children:"VSA feature coming soon..."})}),o==="documents"&&e.jsx("div",{className:"customer-details__tab-panel",children:e.jsx("p",{className:"customer-details__placeholder",children:"Documents feature coming soon..."})}),o==="scanner"&&e.jsx("div",{className:"customer-details__tab-panel",children:e.jsx("p",{className:"customer-details__placeholder",children:"Scanner feature coming soon..."})})]}),e.jsx(ve,{isOpen:h,onClose:()=>d(!1),title:"Delete Customer",size:"small",children:e.jsxs("div",{className:"customer-details__delete-modal",children:[e.jsxs("p",{children:["Are you sure you want to delete ",e.jsx("strong",{children:n.name}),"? This action cannot be undone."]}),e.jsxs("div",{className:"customer-details__delete-actions",children:[e.jsx(C,{variant:"ghost",onClick:()=>d(!1),children:"Cancel"}),e.jsx(C,{variant:"danger",onClick:N,loading:u.isPending,children:"Delete Customer"})]})]})})]})};function Se(s){return{nricCollected:"NRIC Collected",testDriveCompleted:"Test Drive Completed",vsaSigned:"VSA Signed",tradeInDocuments:"Trade-In Documents Received",paymentReceived:"Payment Received"}[s]||s}function V(){const{isSignedIn:s,isInitialized:t,isLoading:a,signIn:i,signOut:n,consultant:r}=he(),[l,u]=_.useState("list"),[c,o]=_.useState(null);if(_.useEffect(()=>{console.log("Dashboard mounted"),console.log("Auth state:",{isSignedIn:s,isInitialized:t,isLoading:a})},[s,t,a]),!t||a)return e.jsx("div",{className:"dashboard",children:e.jsxs("div",{className:"dashboard-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading BYD CRM..."})]})});if(!s)return e.jsx("div",{className:"dashboard",children:e.jsx("div",{className:"dashboard-signin",children:e.jsxs("div",{className:"signin-card",children:[e.jsx("h1",{children:"BYD CRM"}),e.jsx("p",{children:"Customer Relationship Management System"}),e.jsx("p",{className:"signin-subtitle",children:"Sign in with your Google account to access your customer data"}),e.jsxs("button",{className:"btn-signin",onClick:i,children:[e.jsxs("svg",{width:"18",height:"18",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",children:[e.jsx("path",{fill:"#EA4335",d:"M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"}),e.jsx("path",{fill:"#4285F4",d:"M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"}),e.jsx("path",{fill:"#FBBC05",d:"M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"}),e.jsx("path",{fill:"#34A853",d:"M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"})]}),"Sign in with Google"]})]})})});const m=S=>{o(S),u("details")},h=()=>{o(null),u("create")},d=S=>{o(S),u("edit")},N=()=>{o(null),u("list")},x=()=>{o(null),u("list")},g=()=>{o(null),u("list")};return e.jsxs("div",{className:"dashboard",children:[e.jsx("header",{className:"dashboard-header",children:e.jsxs("div",{className:"header-content",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{children:"BYD CRM"}),l!=="list"&&e.jsxs("span",{className:"header-breadcrumb",children:[l==="create"&&"/ New Customer",l==="edit"&&`/ Edit: ${c==null?void 0:c.name}`,l==="details"&&`/ ${c==null?void 0:c.name}`]})]}),e.jsxs("div",{className:"header-user",children:[e.jsx("img",{src:r==null?void 0:r.picture,alt:r==null?void 0:r.name,className:"user-avatar"}),e.jsx("span",{className:"user-name",children:r==null?void 0:r.name}),e.jsx(C,{variant:"ghost",size:"small",onClick:n,children:"Sign Out"})]})]})}),e.jsxs("main",{className:"dashboard-main",children:[l==="list"&&e.jsx(ye,{onSelectCustomer:m,onCreateCustomer:h}),l==="create"&&e.jsxs("div",{className:"dashboard-form-container",children:[e.jsx("h2",{className:"dashboard-form-title",children:"Create New Customer"}),e.jsx(U,{mode:"create",onSuccess:x,onCancel:g})]}),l==="edit"&&c&&e.jsxs("div",{className:"dashboard-form-container",children:[e.jsx("h2",{className:"dashboard-form-title",children:"Edit Customer"}),e.jsx(U,{customer:c,mode:"edit",onSuccess:x,onCancel:g})]}),l==="details"&&c&&e.jsx(we,{customerId:c.id,onEdit:d,onBack:N,onDeleted:N})]})]})}const Ie=new ne({defaultOptions:{queries:{staleTime:5*60*1e3,retry:3}}});function ke(){return _.useEffect(()=>{const{valid:s,errors:t}=de();s?console.log("âœ… Configuration valid"):(console.error("âŒ Configuration errors:",t),t.forEach(a=>console.error(`  - ${a}`))),console.log(`ğŸš€ ${T.APP.NAME} v${T.APP.VERSION}`),console.log(`ğŸŒ Environment: ${T.APP.ENV}`)},[]),e.jsx(ie,{client:Ie,children:e.jsx(re,{basename:"/BYD-CRM-2",children:e.jsxs(le,{children:[e.jsx($,{path:"/",element:e.jsx(V,{})}),e.jsx($,{path:"*",element:e.jsx(V,{})})]})})})}z.createRoot(document.getElementById("root")).render(e.jsx(oe.StrictMode,{children:e.jsx(ke,{})}));
//# sourceMappingURL=index-CPm0GfC6.js.map
